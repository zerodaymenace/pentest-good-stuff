# ref
* https://vegardw.medium.com/reverse-socks-proxy-using-chisel-the-easy-way-48a78df92f29
* https://nullsweep.com/pivot-cheatsheet-for-pentesters/

# ssh tunnel
> ssh -L 18443:<remote-ip>:8443 -L 17443:<remote-ip>:7443 user@<pivot-ip> -p 22000
> ssh -N -D 127.0.0.1:8080 -oKexAlgorithms=+diffie-hellman-group1-sha1 -c 3des-cbc user@<pivot-ip>
> sshuttle -e 'ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -c 3des-cbc' -l 127.0.0.1:8080 -r user@<pivot-ip>:22000 -N
* nmap scans
    > nmap -p- --min-rate=1000 -T4 <ip> -vvv --proxy http://127.0.0.1:8080
    > proxychains nmap -p- -T4 <ip> -vvv
* Dynamic port forwarding through two hops
    > ssh -J user@<pivot-ip> -D 1080 hacker@<ip>

## ncat http tunnel
* on pivot
> sudo ncat -vvv --listen 443 --proxy-type http --ssl
* attacker machine (metasploit)
> /etc/proxychains.conf -n 3
> proxychains <cmd>
```
# defaults set to "tor"
#socks4 	127.0.0.1 9050
```

## ssh tunnel
* on client, setup proxychain 
> ssh -D localhost:4321 -f -N user@ip_address


# chisel
* on kali:
    > chisel server -p 8080 --reverse
* on pivot:
    > chisel client <remote-ip>:8080 R:socks
* /etc/proxychains.conf
    * comment out `proxy_dns` for nmap to work
    * socks5 127.0.0.1 1080


# internet access through squid
* https://www.tecmint.com/install-squid-in-ubuntu/
* https://www.serverlab.ca/tutorials/linux/administration-linux/how-to-set-the-proxy-for-apt-for-ubuntu-18-04/
* on kali
> apt -y install squid
> /etc/squid/squid.conf
acl localnet src <ip>
http_access deny all -> http_access allow all
> service squid restart
* on router
> sudo touch /etc/apt/apt.conf.d/proxy.conf
> sudo vi /etc/apt/apt.conf.d/proxy.conf
    > Acquire::http::Proxy "http://<ip>:3128/";
> sudo rm /etc/apt/apt.conf.d/proxy.conf


# good tools
* net-tools
* nmap
